<!DOCTYPE html>
<html>
<head>
  <title>jquery.nicescroll.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../doc-style.css" />
  <script src="../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../";
    var thisFile = "public\\modules\\jquery.nicescroll\\jquery.nicescroll.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h2">
        <a href="#jquery.nicescroll-version-3.7.6-copyright-2017-07-19-inuyaksa*2017-licensed-under-the-mit">jquery.nicescroll
-- version 3.7.6
-- copyright 2017-07-19 InuYaksa*2017
-- licensed under the MIT</a>
      </div>

      <div class="heading h2">
        <a href="#https-nicescroll.areaaperta.com-https-github.cominuyaksajquery.nicescroll">-- https://nicescroll.areaaperta.com/
-- https://github.com/inuyaksa/jquery.nicescroll</a>
      </div>

      <div class="heading h2">
        <a href="#check-webkit-based-desktop-with-touch-support">Check WebKit-based desktop with touch support</a>
      </div>

      <div class="heading h2">
        <a href="#+-firefox-18-nightly-build-desktop-false-positive-or-desktop-with-touch-support">+ Firefox 18 nightly build (desktop) false positive (or desktop with touch support)</a>
      </div>

      <div class="heading h2">
        <a href="#disable-mouselock-api-on-user-request">disable MouseLock API on user request</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="jquery.nicescroll-version-3.7.6-copyright-2017-07-19-inuyaksa*2017-licensed-under-the-mit">
  <h2>
    <a href="#jquery.nicescroll-version-3.7.6-copyright-2017-07-19-inuyaksa*2017-licensed-under-the-mit" name="jquery.nicescroll-version-3.7.6-copyright-2017-07-19-inuyaksa*2017-licensed-under-the-mit" class="pilcrow"></a>
jquery.nicescroll
-- version 3.7.6
-- copyright 2017-07-19 InuYaksa*2017
-- licensed under the MIT
  </h2>
</div>
<div class="pilwrap" id="https-nicescroll.areaaperta.com-https-github.cominuyaksajquery.nicescroll">
  <h2>
    <a href="#https-nicescroll.areaaperta.com-https-github.cominuyaksajquery.nicescroll" name="https-nicescroll.areaaperta.com-https-github.cominuyaksajquery.nicescroll" class="pilcrow"></a>
-- https://nicescroll.areaaperta.com/
-- https://github.com/inuyaksa/jquery.nicescroll
  </h2>
</div>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-comment">/* jshint expr: true */</span>

(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">factory</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> define === <span class="hljs-string">'function'</span> &amp;&amp; define.amd) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>AMD. Register as anonymous module.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    define([<span class="hljs-string">'jquery'</span>], factory);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> exports === <span class="hljs-string">'object'</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>Node/CommonJS.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-built_in">module</span>.exports = factory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'jquery'</span>));
  } <span class="hljs-keyword">else</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>Browser globals.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    factory(jQuery);
  }
}(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">jQuery</span>) </span>{<span class="hljs-meta">

  "use strict"</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>globals</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> domfocus = <span class="hljs-literal">false</span>,
    mousefocus = <span class="hljs-literal">false</span>,
    tabindexcounter = <span class="hljs-number">0</span>,
    ascrailcounter = <span class="hljs-number">2000</span>,
    globalmaxzindex = <span class="hljs-number">0</span>;

  <span class="hljs-keyword">var</span> $ = jQuery,       <span class="hljs-comment">// sandbox</span>
    _doc = <span class="hljs-built_in">document</span>,
    _win = <span class="hljs-built_in">window</span>,
    $<span class="hljs-built_in">window</span> = $(_win);

  <span class="hljs-keyword">var</span> delegatevents = [];

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>http://stackoverflow.com/questions/2161159/get-script-path</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getScriptPath</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> scripts = _doc.currentScript || (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">var</span> s = _doc.getElementsByTagName(<span class="hljs-string">'script'</span>); <span class="hljs-keyword">return</span> (s.length) ? s[s.length - <span class="hljs-number">1</span>] : <span class="hljs-literal">false</span>; })();
    <span class="hljs-keyword">var</span> path = scripts ? scripts.src.split(<span class="hljs-string">'?'</span>)[<span class="hljs-number">0</span>] : <span class="hljs-string">''</span>;
    <span class="hljs-keyword">return</span> (path.split(<span class="hljs-string">'/'</span>).length &gt; <span class="hljs-number">0</span>) ? path.split(<span class="hljs-string">'/'</span>).slice(<span class="hljs-number">0</span>, <span class="hljs-number">-1</span>).join(<span class="hljs-string">'/'</span>) + <span class="hljs-string">'/'</span> : <span class="hljs-string">''</span>;
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>based on code by Paul Irish https://www.paulirish.com/2011/requestanimationframe-for-smart-animating/</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> setAnimationFrame = _win.requestAnimationFrame || _win.webkitRequestAnimationFrame || _win.mozRequestAnimationFrame || <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">var</span> clearAnimationFrame = _win.cancelAnimationFrame || _win.webkitCancelAnimationFrame || _win.mozCancelAnimationFrame || <span class="hljs-literal">false</span>;

  <span class="hljs-keyword">if</span> (!setAnimationFrame) {
    <span class="hljs-keyword">var</span> anilasttime = <span class="hljs-number">0</span>;
    setAnimationFrame = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">callback, element</span>) </span>{
      <span class="hljs-keyword">var</span> currTime = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime();
      <span class="hljs-keyword">var</span> timeToCall = <span class="hljs-built_in">Math</span>.max(<span class="hljs-number">0</span>, <span class="hljs-number">16</span> - (currTime - anilasttime));
      <span class="hljs-keyword">var</span> id = _win.setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ callback(currTime + timeToCall); },
        timeToCall);
      anilasttime = currTime + timeToCall;
      <span class="hljs-keyword">return</span> id;
    };
    clearAnimationFrame = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">id</span>) </span>{
      _win.clearTimeout(id);
    };
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">if</span> (!_win.cancelAnimationFrame) clearAnimationFrame = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">id</span>) </span>{ };
  }

  <span class="hljs-keyword">var</span> ClsMutationObserver = _win.MutationObserver || _win.WebKitMutationObserver || <span class="hljs-literal">false</span>;

  <span class="hljs-keyword">var</span> now = <span class="hljs-built_in">Date</span>.now || <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime(); };

  <span class="hljs-keyword">var</span> _globaloptions = {
    <span class="hljs-attr">zindex</span>: <span class="hljs-string">"auto"</span>,
    <span class="hljs-attr">cursoropacitymin</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">cursoropacitymax</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">cursorcolor</span>: <span class="hljs-string">"#424242"</span>,
    <span class="hljs-attr">cursorwidth</span>: <span class="hljs-string">"6px"</span>,
    <span class="hljs-attr">cursorborder</span>: <span class="hljs-string">"1px solid #fff"</span>,
    <span class="hljs-attr">cursorborderradius</span>: <span class="hljs-string">"5px"</span>,
    <span class="hljs-attr">scrollspeed</span>: <span class="hljs-number">40</span>,
    <span class="hljs-attr">mousescrollstep</span>: <span class="hljs-number">9</span> * <span class="hljs-number">3</span>,
    <span class="hljs-attr">touchbehavior</span>: <span class="hljs-literal">false</span>,   <span class="hljs-comment">// deprecated</span>
    <span class="hljs-attr">emulatetouch</span>: <span class="hljs-literal">false</span>,    <span class="hljs-comment">// replacing touchbehavior</span>
    <span class="hljs-attr">hwacceleration</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">usetransition</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">boxzoom</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">dblclickzoom</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">gesturezoom</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">grabcursorenabled</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">autohidemode</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">background</span>: <span class="hljs-string">""</span>,
    <span class="hljs-attr">iframeautoresize</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">cursorminheight</span>: <span class="hljs-number">32</span>,
    <span class="hljs-attr">preservenativescrolling</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">railoffset</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">railhoffset</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">bouncescroll</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">spacebarenabled</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">railpadding</span>: {
      <span class="hljs-attr">top</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">right</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">left</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">bottom</span>: <span class="hljs-number">0</span>
    },
    <span class="hljs-attr">disableoutline</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">horizrailenabled</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">railalign</span>: <span class="hljs-string">"right"</span>,
    <span class="hljs-attr">railvalign</span>: <span class="hljs-string">"bottom"</span>,
    <span class="hljs-attr">enabletranslate3d</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">enablemousewheel</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">enablekeyboard</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">smoothscroll</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">sensitiverail</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">enablemouselockapi</span>: <span class="hljs-literal">true</span>,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<pre><code> cursormaxheight:false,
</code></pre>

        </td>
        <td class="code highlight">
          <pre class="javascript">    cursorfixedheight: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">directionlockdeadzone</span>: <span class="hljs-number">6</span>,
    <span class="hljs-attr">hidecursordelay</span>: <span class="hljs-number">400</span>,
    <span class="hljs-attr">nativeparentscrolling</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">enablescrollonselection</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">overflowx</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">overflowy</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">cursordragspeed</span>: <span class="hljs-number">0.3</span>,
    <span class="hljs-attr">rtlmode</span>: <span class="hljs-string">"auto"</span>,
    <span class="hljs-attr">cursordragontouch</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">oneaxismousemode</span>: <span class="hljs-string">"auto"</span>,
    <span class="hljs-attr">scriptpath</span>: getScriptPath(),
    <span class="hljs-attr">preventmultitouchscrolling</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">disablemutationobserver</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">enableobserver</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">scrollbarid</span>: <span class="hljs-literal">false</span>
  };

  <span class="hljs-keyword">var</span> browserdetected = <span class="hljs-literal">false</span>;

  <span class="hljs-keyword">var</span> getBrowserDetection = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">if</span> (browserdetected) <span class="hljs-keyword">return</span> browserdetected;

    <span class="hljs-keyword">var</span> _el = _doc.createElement(<span class="hljs-string">'DIV'</span>),
      _style = _el.style,
      _agent = navigator.userAgent,
      _platform = navigator.platform,
      d = {};

    d.haspointerlock = <span class="hljs-string">"pointerLockElement"</span> <span class="hljs-keyword">in</span> _doc || <span class="hljs-string">"webkitPointerLockElement"</span> <span class="hljs-keyword">in</span> _doc || <span class="hljs-string">"mozPointerLockElement"</span> <span class="hljs-keyword">in</span> _doc;

    d.isopera = (<span class="hljs-string">"opera"</span> <span class="hljs-keyword">in</span> _win); <span class="hljs-comment">// 12-</span>
    d.isopera12 = (d.isopera &amp;&amp; (<span class="hljs-string">"getUserMedia"</span> <span class="hljs-keyword">in</span> navigator));
    d.isoperamini = (<span class="hljs-built_in">Object</span>.prototype.toString.call(_win.operamini) === <span class="hljs-string">"[object OperaMini]"</span>);

    d.isie = ((<span class="hljs-string">"all"</span> <span class="hljs-keyword">in</span> _doc) &amp;&amp; (<span class="hljs-string">"attachEvent"</span> <span class="hljs-keyword">in</span> _el) &amp;&amp; !d.isopera); <span class="hljs-comment">//IE10-</span>
    d.isieold = (d.isie &amp;&amp; !(<span class="hljs-string">"msInterpolationMode"</span> <span class="hljs-keyword">in</span> _style)); <span class="hljs-comment">// IE6 and older</span>
    d.isie7 = d.isie &amp;&amp; !d.isieold &amp;&amp; (!(<span class="hljs-string">"documentMode"</span> <span class="hljs-keyword">in</span> _doc) || (_doc.documentMode === <span class="hljs-number">7</span>));
    d.isie8 = d.isie &amp;&amp; (<span class="hljs-string">"documentMode"</span> <span class="hljs-keyword">in</span> _doc) &amp;&amp; (_doc.documentMode === <span class="hljs-number">8</span>);
    d.isie9 = d.isie &amp;&amp; (<span class="hljs-string">"performance"</span> <span class="hljs-keyword">in</span> _win) &amp;&amp; (_doc.documentMode === <span class="hljs-number">9</span>);
    d.isie10 = d.isie &amp;&amp; (<span class="hljs-string">"performance"</span> <span class="hljs-keyword">in</span> _win) &amp;&amp; (_doc.documentMode === <span class="hljs-number">10</span>);
    d.isie11 = (<span class="hljs-string">"msRequestFullscreen"</span> <span class="hljs-keyword">in</span> _el) &amp;&amp; (_doc.documentMode &gt;= <span class="hljs-number">11</span>); <span class="hljs-comment">// IE11+</span>

    d.ismsedge = (<span class="hljs-string">"msCredentials"</span> <span class="hljs-keyword">in</span> _win);  <span class="hljs-comment">// MS Edge 14+</span>

    d.ismozilla = (<span class="hljs-string">"MozAppearance"</span> <span class="hljs-keyword">in</span> _style);

    d.iswebkit = !d.ismsedge &amp;&amp; (<span class="hljs-string">"WebkitAppearance"</span> <span class="hljs-keyword">in</span> _style);

    d.ischrome = d.iswebkit &amp;&amp; (<span class="hljs-string">"chrome"</span> <span class="hljs-keyword">in</span> _win);
    d.ischrome38 = (d.ischrome &amp;&amp; (<span class="hljs-string">"touchAction"</span> <span class="hljs-keyword">in</span> _style)); <span class="hljs-comment">// behavior changed in touch emulation    </span>
    d.ischrome22 = (!d.ischrome38) &amp;&amp; (d.ischrome &amp;&amp; d.haspointerlock);
    d.ischrome26 = (!d.ischrome38) &amp;&amp; (d.ischrome &amp;&amp; (<span class="hljs-string">"transition"</span> <span class="hljs-keyword">in</span> _style)); <span class="hljs-comment">// issue with transform detection (maintain prefix)</span>

    d.cantouch = (<span class="hljs-string">"ontouchstart"</span> <span class="hljs-keyword">in</span> _doc.documentElement) || (<span class="hljs-string">"ontouchstart"</span> <span class="hljs-keyword">in</span> _win); <span class="hljs-comment">// with detection for Chrome Touch Emulation    </span>
    d.hasw3ctouch = (_win.PointerEvent || <span class="hljs-literal">false</span>) &amp;&amp; ((navigator.maxTouchPoints &gt; <span class="hljs-number">0</span>) || (navigator.msMaxTouchPoints &gt; <span class="hljs-number">0</span>)); <span class="hljs-comment">//IE11 pointer events, following W3C Pointer Events spec</span>
    d.hasmstouch = (!d.hasw3ctouch) &amp;&amp; (_win.MSPointerEvent || <span class="hljs-literal">false</span>); <span class="hljs-comment">// IE10 pointer events</span>

    d.ismac = <span class="hljs-regexp">/^mac$/i</span>.test(_platform);

    d.isios = d.cantouch &amp;&amp; <span class="hljs-regexp">/iphone|ipad|ipod/i</span>.test(_platform);
    d.isios4 = d.isios &amp;&amp; !(<span class="hljs-string">"seal"</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">Object</span>);
    d.isios7 = d.isios &amp;&amp; (<span class="hljs-string">"webkitHidden"</span> <span class="hljs-keyword">in</span> _doc);  <span class="hljs-comment">//iOS 7+</span>
    d.isios8 = d.isios &amp;&amp; (<span class="hljs-string">"hidden"</span> <span class="hljs-keyword">in</span> _doc);  <span class="hljs-comment">//iOS 8+</span>
    d.isios10 = d.isios &amp;&amp; _win.Proxy;  <span class="hljs-comment">//iOS 10+</span>

    d.isandroid = (<span class="hljs-regexp">/android/i</span>.test(_agent));

    d.haseventlistener = (<span class="hljs-string">"addEventListener"</span> <span class="hljs-keyword">in</span> _el);

    d.trstyle = <span class="hljs-literal">false</span>;
    d.hastransform = <span class="hljs-literal">false</span>;
    d.hastranslate3d = <span class="hljs-literal">false</span>;
    d.transitionstyle = <span class="hljs-literal">false</span>;
    d.hastransition = <span class="hljs-literal">false</span>;
    d.transitionend = <span class="hljs-literal">false</span>;

    d.trstyle = <span class="hljs-string">"transform"</span>;
    d.hastransform = (<span class="hljs-string">"transform"</span> <span class="hljs-keyword">in</span> _style) || (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> check = [<span class="hljs-string">'msTransform'</span>, <span class="hljs-string">'webkitTransform'</span>, <span class="hljs-string">'MozTransform'</span>, <span class="hljs-string">'OTransform'</span>];
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> a = <span class="hljs-number">0</span>, c = check.length; a &lt; c; a++) {
        <span class="hljs-keyword">if</span> (_style[check[a]] !== <span class="hljs-literal">undefined</span>) {
          d.trstyle = check[a];
          <span class="hljs-keyword">break</span>;
        }
      }
      d.hastransform = (!!d.trstyle);
    })();

    <span class="hljs-keyword">if</span> (d.hastransform) {
      _style[d.trstyle] = <span class="hljs-string">"translate3d(1px,2px,3px)"</span>;
      d.hastranslate3d = <span class="hljs-regexp">/translate3d/</span>.test(_style[d.trstyle]);
    }

    d.transitionstyle = <span class="hljs-string">"transition"</span>;
    d.prefixstyle = <span class="hljs-string">''</span>;
    d.transitionend = <span class="hljs-string">"transitionend"</span>;

    d.hastransition = (<span class="hljs-string">"transition"</span> <span class="hljs-keyword">in</span> _style) || (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

      d.transitionend = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">var</span> check = [<span class="hljs-string">'webkitTransition'</span>, <span class="hljs-string">'msTransition'</span>, <span class="hljs-string">'MozTransition'</span>, <span class="hljs-string">'OTransition'</span>, <span class="hljs-string">'OTransition'</span>, <span class="hljs-string">'KhtmlTransition'</span>];
      <span class="hljs-keyword">var</span> prefix = [<span class="hljs-string">'-webkit-'</span>, <span class="hljs-string">'-ms-'</span>, <span class="hljs-string">'-moz-'</span>, <span class="hljs-string">'-o-'</span>, <span class="hljs-string">'-o'</span>, <span class="hljs-string">'-khtml-'</span>];
      <span class="hljs-keyword">var</span> evs = [<span class="hljs-string">'webkitTransitionEnd'</span>, <span class="hljs-string">'msTransitionEnd'</span>, <span class="hljs-string">'transitionend'</span>, <span class="hljs-string">'otransitionend'</span>, <span class="hljs-string">'oTransitionEnd'</span>, <span class="hljs-string">'KhtmlTransitionEnd'</span>];
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> a = <span class="hljs-number">0</span>, c = check.length; a &lt; c; a++) {
        <span class="hljs-keyword">if</span> (check[a] <span class="hljs-keyword">in</span> _style) {
          d.transitionstyle = check[a];
          d.prefixstyle = prefix[a];
          d.transitionend = evs[a];
          <span class="hljs-keyword">break</span>;
        }
      }
      <span class="hljs-keyword">if</span> (d.ischrome26) d.prefixstyle = prefix[<span class="hljs-number">1</span>];  <span class="hljs-comment">// always use prefix</span>

      d.hastransition = (d.transitionstyle);

    })();

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">detectCursorGrab</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> lst = [<span class="hljs-string">'grab'</span>, <span class="hljs-string">'-webkit-grab'</span>, <span class="hljs-string">'-moz-grab'</span>];
      <span class="hljs-keyword">if</span> ((d.ischrome &amp;&amp; !d.ischrome38) || d.isie) lst = []; <span class="hljs-comment">// force setting for IE returns false positive and chrome cursor bug</span>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> a = <span class="hljs-number">0</span>, l = lst.length; a &lt; l; a++) {
        <span class="hljs-keyword">var</span> p = lst[a];
        _style.cursor = p;
        <span class="hljs-keyword">if</span> (_style.cursor == p) <span class="hljs-keyword">return</span> p;
      }
      <span class="hljs-keyword">return</span> <span class="hljs-string">'url(https://cdnjs.cloudflare.com/ajax/libs/slider-pro/1.3.0/css/images/openhand.cur),n-resize'</span>; <span class="hljs-comment">// thanks to https://cdnjs.com/ for the openhand cursor!</span>
    }
    d.cursorgrabvalue = detectCursorGrab();

    d.hasmousecapture = (<span class="hljs-string">"setCapture"</span> <span class="hljs-keyword">in</span> _el);

    d.hasMutationObserver = (ClsMutationObserver !== <span class="hljs-literal">false</span>);

    _el = <span class="hljs-literal">null</span>; <span class="hljs-comment">//memory released</span>

    browserdetected = d;

    <span class="hljs-keyword">return</span> d;
  };

  <span class="hljs-keyword">var</span> NiceScrollClass = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">myopt, me</span>) </span>{

    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">this</span>.version = <span class="hljs-string">'3.7.6'</span>;
    <span class="hljs-keyword">this</span>.name = <span class="hljs-string">'nicescroll'</span>;

    <span class="hljs-keyword">this</span>.me = me;

    <span class="hljs-keyword">var</span> $body = $(<span class="hljs-string">"body"</span>);

    <span class="hljs-keyword">var</span> opt = <span class="hljs-keyword">this</span>.opt = {
      <span class="hljs-attr">doc</span>: $body,
      <span class="hljs-attr">win</span>: <span class="hljs-literal">false</span>
    };

    $.extend(opt, _globaloptions);  <span class="hljs-comment">// clone opts</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>Options for internal use</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    opt.snapbackspeed = <span class="hljs-number">80</span>;

    <span class="hljs-keyword">if</span> (myopt || <span class="hljs-literal">false</span>) {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> a <span class="hljs-keyword">in</span> opt) {
        <span class="hljs-keyword">if</span> (myopt[a] !== <span class="hljs-literal">undefined</span>) opt[a] = myopt[a];
      }
    }

    <span class="hljs-keyword">if</span> (opt.disablemutationobserver) ClsMutationObserver = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">this</span>.doc = opt.doc;
    <span class="hljs-keyword">this</span>.iddoc = (<span class="hljs-keyword">this</span>.doc &amp;&amp; <span class="hljs-keyword">this</span>.doc[<span class="hljs-number">0</span>]) ? <span class="hljs-keyword">this</span>.doc[<span class="hljs-number">0</span>].id || <span class="hljs-string">''</span> : <span class="hljs-string">''</span>;
    <span class="hljs-keyword">this</span>.ispage = <span class="hljs-regexp">/^BODY|HTML/</span>.test((opt.win) ? opt.win[<span class="hljs-number">0</span>].nodeName : <span class="hljs-keyword">this</span>.doc[<span class="hljs-number">0</span>].nodeName);
    <span class="hljs-keyword">this</span>.haswrapper = (opt.win !== <span class="hljs-literal">false</span>);
    <span class="hljs-keyword">this</span>.win = opt.win || (<span class="hljs-keyword">this</span>.ispage ? $<span class="hljs-built_in">window</span> : <span class="hljs-keyword">this</span>.doc);
    <span class="hljs-keyword">this</span>.docscroll = (<span class="hljs-keyword">this</span>.ispage &amp;&amp; !<span class="hljs-keyword">this</span>.haswrapper) ? $<span class="hljs-built_in">window</span> : <span class="hljs-keyword">this</span>.win;
    <span class="hljs-keyword">this</span>.body = $body;
    <span class="hljs-keyword">this</span>.viewport = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">this</span>.isfixed = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">this</span>.iframe = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.isiframe = ((<span class="hljs-keyword">this</span>.doc[<span class="hljs-number">0</span>].nodeName == <span class="hljs-string">'IFRAME'</span>) &amp;&amp; (<span class="hljs-keyword">this</span>.win[<span class="hljs-number">0</span>].nodeName == <span class="hljs-string">'IFRAME'</span>));

    <span class="hljs-keyword">this</span>.istextarea = (<span class="hljs-keyword">this</span>.win[<span class="hljs-number">0</span>].nodeName == <span class="hljs-string">'TEXTAREA'</span>);

    <span class="hljs-keyword">this</span>.forcescreen = <span class="hljs-literal">false</span>; <span class="hljs-comment">//force to use screen position on events</span>

    <span class="hljs-keyword">this</span>.canshowonmouseevent = (opt.autohidemode != <span class="hljs-string">"scroll"</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>Events jump table</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">this</span>.onmousedown = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.onmouseup = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.onmousemove = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.onmousewheel = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.onkeypress = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.ongesturezoom = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.onclick = <span class="hljs-literal">false</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>Nicescroll custom events</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">this</span>.onscrollstart = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.onscrollend = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.onscrollcancel = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">this</span>.onzoomin = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.onzoomout = <span class="hljs-literal">false</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>Let's start!</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">this</span>.view = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.page = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">this</span>.scroll = {
      <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>
    };
    <span class="hljs-keyword">this</span>.scrollratio = {
      <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>
    };
    <span class="hljs-keyword">this</span>.cursorheight = <span class="hljs-number">20</span>;
    <span class="hljs-keyword">this</span>.scrollvaluemax = <span class="hljs-number">0</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>http://dev.w3.org/csswg/css-writing-modes-3/#logical-to-physical
http://dev.w3.org/csswg/css-writing-modes-3/#svg-writing-mode</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (opt.rtlmode == <span class="hljs-string">"auto"</span>) {
      <span class="hljs-keyword">var</span> target = <span class="hljs-keyword">this</span>.win[<span class="hljs-number">0</span>] == _win ? <span class="hljs-keyword">this</span>.body : <span class="hljs-keyword">this</span>.win;
      <span class="hljs-keyword">var</span> writingMode = target.css(<span class="hljs-string">"writing-mode"</span>) || target.css(<span class="hljs-string">"-webkit-writing-mode"</span>) || target.css(<span class="hljs-string">"-ms-writing-mode"</span>) || target.css(<span class="hljs-string">"-moz-writing-mode"</span>);

      <span class="hljs-keyword">if</span> (writingMode == <span class="hljs-string">"horizontal-tb"</span> || writingMode == <span class="hljs-string">"lr-tb"</span> || writingMode === <span class="hljs-string">""</span>) {
        <span class="hljs-keyword">this</span>.isrtlmode = (target.css(<span class="hljs-string">"direction"</span>) == <span class="hljs-string">"rtl"</span>);
        <span class="hljs-keyword">this</span>.isvertical = <span class="hljs-literal">false</span>;
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>.isrtlmode = (writingMode == <span class="hljs-string">"vertical-rl"</span> || writingMode == <span class="hljs-string">"tb"</span> || writingMode == <span class="hljs-string">"tb-rl"</span> || writingMode == <span class="hljs-string">"rl-tb"</span>);
        <span class="hljs-keyword">this</span>.isvertical = (writingMode == <span class="hljs-string">"vertical-rl"</span> || writingMode == <span class="hljs-string">"tb"</span> || writingMode == <span class="hljs-string">"tb-rl"</span>);
      }
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">this</span>.isrtlmode = (opt.rtlmode === <span class="hljs-literal">true</span>);
      <span class="hljs-keyword">this</span>.isvertical = <span class="hljs-literal">false</span>;
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>this.checkrtlmode = false;</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
    <span class="hljs-keyword">this</span>.scrollrunning = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">this</span>.scrollmom = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">this</span>.observer = <span class="hljs-literal">false</span>;  <span class="hljs-comment">// observer div changes</span>
    <span class="hljs-keyword">this</span>.observerremover = <span class="hljs-literal">false</span>;  <span class="hljs-comment">// observer on parent for remove detection</span>
    <span class="hljs-keyword">this</span>.observerbody = <span class="hljs-literal">false</span>;  <span class="hljs-comment">// observer on body for position change</span>

    <span class="hljs-keyword">if</span> (opt.scrollbarid !== <span class="hljs-literal">false</span>) {
      <span class="hljs-keyword">this</span>.id = opt.scrollbarid;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">do</span> {
        <span class="hljs-keyword">this</span>.id = <span class="hljs-string">"ascrail"</span> + (ascrailcounter++);
      } <span class="hljs-keyword">while</span> (_doc.getElementById(<span class="hljs-keyword">this</span>.id));
    }

    <span class="hljs-keyword">this</span>.rail = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.cursor = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.cursorfreezed = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.selectiondrag = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">this</span>.zoom = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.zoomactive = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">this</span>.hasfocus = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.hasmousefocus = <span class="hljs-literal">false</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>this.visibility = true;</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">this</span>.railslocked = <span class="hljs-literal">false</span>;  <span class="hljs-comment">// locked by resize</span>
    <span class="hljs-keyword">this</span>.locked = <span class="hljs-literal">false</span>;  <span class="hljs-comment">// prevent lost of locked status sets by user</span>
    <span class="hljs-keyword">this</span>.hidden = <span class="hljs-literal">false</span>; <span class="hljs-comment">// rails always hidden</span>
    <span class="hljs-keyword">this</span>.cursoractive = <span class="hljs-literal">true</span>; <span class="hljs-comment">// user can interact with cursors</span>

    <span class="hljs-keyword">this</span>.wheelprevented = <span class="hljs-literal">false</span>; <span class="hljs-comment">//prevent mousewheel event</span>

    <span class="hljs-keyword">this</span>.overflowx = opt.overflowx;
    <span class="hljs-keyword">this</span>.overflowy = opt.overflowy;

    <span class="hljs-keyword">this</span>.nativescrollingarea = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.checkarea = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">this</span>.events = []; <span class="hljs-comment">// event list for unbind</span>

    <span class="hljs-keyword">this</span>.saved = {};  <span class="hljs-comment">// style saved</span>

    <span class="hljs-keyword">this</span>.delaylist = {};
    <span class="hljs-keyword">this</span>.synclist = {};

    <span class="hljs-keyword">this</span>.lastdeltax = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.lastdeltay = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">this</span>.detected = getBrowserDetection();

    <span class="hljs-keyword">var</span> cap = $.extend({}, <span class="hljs-keyword">this</span>.detected);

    <span class="hljs-keyword">this</span>.canhwscroll = (cap.hastransform &amp;&amp; opt.hwacceleration);
    <span class="hljs-keyword">this</span>.ishwscroll = (<span class="hljs-keyword">this</span>.canhwscroll &amp;&amp; self.haswrapper);

    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.isrtlmode) {
      <span class="hljs-keyword">this</span>.hasreversehr = <span class="hljs-literal">false</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isvertical) { <span class="hljs-comment">// RTL mode with reverse horizontal axis</span>
      <span class="hljs-keyword">this</span>.hasreversehr = !(cap.iswebkit || cap.isie || cap.isie11);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">this</span>.hasreversehr = !(cap.iswebkit || (cap.isie &amp;&amp; !cap.isie10 &amp;&amp; !cap.isie11));
    }

    <span class="hljs-keyword">this</span>.istouchcapable = <span class="hljs-literal">false</span>; <span class="hljs-comment">// desktop devices with touch screen support</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="check-webkit-based-desktop-with-touch-support">
  <h2>
    <a href="#check-webkit-based-desktop-with-touch-support" name="check-webkit-based-desktop-with-touch-support" class="pilcrow"></a>
Check WebKit-based desktop with touch support
  </h2>
</div>
<div class="pilwrap" id="+-firefox-18-nightly-build-desktop-false-positive-or-desktop-with-touch-support">
  <h2>
    <a href="#+-firefox-18-nightly-build-desktop-false-positive-or-desktop-with-touch-support" name="+-firefox-18-nightly-build-desktop-false-positive-or-desktop-with-touch-support" class="pilcrow"></a>
+ Firefox 18 nightly build (desktop) false positive (or desktop with touch support)
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
    <span class="hljs-keyword">if</span> (!cap.cantouch &amp;&amp; (cap.hasw3ctouch || cap.hasmstouch)) {  <span class="hljs-comment">// desktop device with multiple input</span>
      <span class="hljs-keyword">this</span>.istouchcapable = <span class="hljs-literal">true</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cap.cantouch &amp;&amp; !cap.isios &amp;&amp; !cap.isandroid &amp;&amp; (cap.iswebkit || cap.ismozilla)) {
      <span class="hljs-keyword">this</span>.istouchcapable = <span class="hljs-literal">true</span>;
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="disable-mouselock-api-on-user-request">
  <h2>
    <a href="#disable-mouselock-api-on-user-request" name="disable-mouselock-api-on-user-request" class="pilcrow"></a>
disable MouseLock API on user request
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (!opt.enablemouselockapi) {
      cap.hasmousecapture = <span class="hljs-literal">false</span>;
      cap.haspointerlock = <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">this</span>.debounced = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, fn, tm</span>) </span>{
      <span class="hljs-keyword">if</span> (!self) <span class="hljs-keyword">return</span>;
      <span class="hljs-keyword">var</span> dd = self.delaylist[name] || <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">if</span> (!dd) {
        self.delaylist[name] = {
          <span class="hljs-attr">h</span>: setAnimationFrame(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            self.delaylist[name].fn.call(self);
            self.delaylist[name] = <span class="hljs-literal">false</span>;
          }, tm)
        };
        fn.call(self);
      }
      self.delaylist[name].fn = fn;
    };


    <span class="hljs-keyword">this</span>.synched = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, fn</span>) </span>{
      <span class="hljs-keyword">if</span> (self.synclist[name]) self.synclist[name] = fn;
      <span class="hljs-keyword">else</span> {
        self.synclist[name] = fn;
        setAnimationFrame(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
          <span class="hljs-keyword">if</span> (!self) <span class="hljs-keyword">return</span>;
          self.synclist[name] &amp;&amp; self.synclist[name].call(self);
          self.synclist[name] = <span class="hljs-literal">null</span>;
        });
      }
    };

    <span class="hljs-keyword">this</span>.unsynched = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name</span>) </span>{
      <span class="hljs-keyword">if</span> (self.synclist[name]) self.synclist[name] = <span class="hljs-literal">false</span>;
    };

    <span class="hljs-keyword">this</span>.css = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">el, pars</span>) </span>{ <span class="hljs-comment">// save &amp; set</span>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> n <span class="hljs-keyword">in</span> pars) {
        self.saved.css.push([el, n, el.css(n)]);
        el.css(n, pars[n]);
      }
    };

    <span class="hljs-keyword">this</span>.scrollTop = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{
      <span class="hljs-keyword">return</span> (val === <span class="hljs-literal">undefined</span>) ? self.getScrollTop() : self.setScrollTop(val);
    };

    <span class="hljs-keyword">this</span>.scrollLeft = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{
      <span class="hljs-keyword">return</span> (val === <span class="hljs-literal">undefined</span>) ? self.getScrollLeft() : self.setScrollLeft(val);
    };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>derived by by Dan Pupius www.pupius.net</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">var</span> BezierClass = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st, ed, spd, p1, p2, p3, p4</span>) </span>{

      <span class="hljs-keyword">this</span>.st = st;
      <span class="hljs-keyword">this</span>.ed = ed;
      <span class="hljs-keyword">this</span>.spd = spd;

      <span class="hljs-keyword">this</span>.p1 = p1 || <span class="hljs-number">0</span>;
      <span class="hljs-keyword">this</span>.p2 = p2 || <span class="hljs-number">1</span>;
      <span class="hljs-keyword">this</span>.p3 = p3 || <span class="hljs-number">0</span>;
      <span class="hljs-keyword">this</span>.p4 = p4 || <span class="hljs-number">1</span>;

      <span class="hljs-keyword">this</span>.ts = now();
      <span class="hljs-keyword">this</span>.df = ed - st;
    };
    BezierClass.prototype = {
      <span class="hljs-attr">B2</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-number">3</span> * (<span class="hljs-number">1</span> - t) * (<span class="hljs-number">1</span> - t) * t;
      },
      <span class="hljs-attr">B3</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-number">3</span> * (<span class="hljs-number">1</span> - t) * t * t;
      },
      <span class="hljs-attr">B4</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
        <span class="hljs-keyword">return</span> t * t * t;
      },
      <span class="hljs-attr">getPos</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> (now() - <span class="hljs-keyword">this</span>.ts) / <span class="hljs-keyword">this</span>.spd;
      },
      <span class="hljs-attr">getNow</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> pc = (now() - <span class="hljs-keyword">this</span>.ts) / <span class="hljs-keyword">this</span>.spd;
        <span class="hljs-keyword">var</span> bz = <span class="hljs-keyword">this</span>.B2(pc) + <span class="hljs-keyword">this</span>.B3(pc) + <span class="hljs-keyword">this</span>.B4(pc);
        <span class="hljs-keyword">return</span> (pc &gt;= <span class="hljs-number">1</span>) ? <span class="hljs-keyword">this</span>.ed : <span class="hljs-keyword">this</span>.st + (<span class="hljs-keyword">this</span>.df * bz) | <span class="hljs-number">0</span>;
      },
      <span class="hljs-attr">update</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ed, spd</span>) </span>{
        <span class="hljs-keyword">this</span>.st = <span class="hljs-keyword">this</span>.getNow();
        <span class="hljs-keyword">this</span>.ed = ed;
        <span class="hljs-keyword">this</span>.spd = spd;
        <span class="hljs-keyword">this</span>.ts = now();
        <span class="hljs-keyword">this</span>.df = <span class="hljs-keyword">this</span>.ed - <span class="hljs-keyword">this</span>.st;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
      }
    };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>derived from http://stackoverflow.com/questions/11236090/</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getMatrixValues</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> tr = self.doc.css(cap.trstyle);
      <span class="hljs-keyword">if</span> (tr &amp;&amp; (tr.substr(<span class="hljs-number">0</span>, <span class="hljs-number">6</span>) == <span class="hljs-string">"matrix"</span>)) {
        <span class="hljs-keyword">return</span> tr.replace(<span class="hljs-regexp">/^.*\((.*)\)$/g</span>, <span class="hljs-string">"$1"</span>).replace(<span class="hljs-regexp">/px/g</span>, <span class="hljs-string">''</span>).split(<span class="hljs-regexp">/, +/</span>);
      }
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.ishwscroll) {    <span class="hljs-comment">// hw accelerated scroll</span>

      <span class="hljs-keyword">this</span>.doc.translate = {
        <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">tx</span>: <span class="hljs-string">"0px"</span>,
        <span class="hljs-attr">ty</span>: <span class="hljs-string">"0px"</span>
      };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>this one can help to enable hw accel on ios6 http://indiegamr.com/ios6-html-hardware-acceleration-changes-and-how-to-fix-them/</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">if</span> (cap.hastranslate3d &amp;&amp; cap.isios) <span class="hljs-keyword">this</span>.doc.css(<span class="hljs-string">"-webkit-backface-visibility"</span>, <span class="hljs-string">"hidden"</span>); <span class="hljs-comment">// prevent flickering http://stackoverflow.com/questions/3461441/      </span>

      <span class="hljs-keyword">this</span>.getScrollTop = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">last</span>) </span>{
        <span class="hljs-keyword">if</span> (!last) {
          <span class="hljs-keyword">var</span> mtx = getMatrixValues();
          <span class="hljs-keyword">if</span> (mtx) <span class="hljs-keyword">return</span> (mtx.length == <span class="hljs-number">16</span>) ? -mtx[<span class="hljs-number">13</span>] : -mtx[<span class="hljs-number">5</span>]; <span class="hljs-comment">//matrix3d 16 on IE10</span>
          <span class="hljs-keyword">if</span> (self.timerscroll &amp;&amp; self.timerscroll.bz) <span class="hljs-keyword">return</span> self.timerscroll.bz.getNow();
        }
        <span class="hljs-keyword">return</span> self.doc.translate.y;
      };

      <span class="hljs-keyword">this</span>.getScrollLeft = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">last</span>) </span>{
        <span class="hljs-keyword">if</span> (!last) {
          <span class="hljs-keyword">var</span> mtx = getMatrixValues();
          <span class="hljs-keyword">if</span> (mtx) <span class="hljs-keyword">return</span> (mtx.length == <span class="hljs-number">16</span>) ? -mtx[<span class="hljs-number">12</span>] : -mtx[<span class="hljs-number">4</span>]; <span class="hljs-comment">//matrix3d 16 on IE10</span>
          <span class="hljs-keyword">if</span> (self.timerscroll &amp;&amp; self.timerscroll.bh) <span class="hljs-keyword">return</span> self.timerscroll.bh.getNow();
        }
        <span class="hljs-keyword">return</span> self.doc.translate.x;
      };

      <span class="hljs-keyword">this</span>.notifyScrollEvent = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">el</span>) </span>{
        <span class="hljs-keyword">var</span> e = _doc.createEvent(<span class="hljs-string">"UIEvents"</span>);
        e.initUIEvent(<span class="hljs-string">"scroll"</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, _win, <span class="hljs-number">1</span>);
        e.niceevent = <span class="hljs-literal">true</span>;
        el.dispatchEvent(e);
      };

      <span class="hljs-keyword">var</span> cxscrollleft = (<span class="hljs-keyword">this</span>.isrtlmode) ? <span class="hljs-number">1</span> : <span class="hljs-number">-1</span>;

      <span class="hljs-keyword">if</span> (cap.hastranslate3d &amp;&amp; opt.enabletranslate3d) {
        <span class="hljs-keyword">this</span>.setScrollTop = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val, silent</span>) </span>{
          self.doc.translate.y = val;
          self.doc.translate.ty = (val * <span class="hljs-number">-1</span>) + <span class="hljs-string">"px"</span>;
          self.doc.css(cap.trstyle, <span class="hljs-string">"translate3d("</span> + self.doc.translate.tx + <span class="hljs-string">","</span> + self.doc.translate.ty + <span class="hljs-string">",0)"</span>);
          <span class="hljs-keyword">if</span> (!silent) self.notifyScrollEvent(self.win[<span class="hljs-number">0</span>]);
        };
        <span class="hljs-keyword">this</span>.setScrollLeft = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val, silent</span>) </span>{
          self.doc.translate.x = val;
          self.doc.translate.tx = (val * cxscrollleft) + <span class="hljs-string">"px"</span>;
          self.doc.css(cap.trstyle, <span class="hljs-string">"translate3d("</span> + self.doc.translate.tx + <span class="hljs-string">","</span> + self.doc.translate.ty + <span class="hljs-string">",0)"</span>);
          <span class="hljs-keyword">if</span> (!silent) self.notifyScrollEvent(self.win[<span class="hljs-number">0</span>]);
        };
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>.setScrollTop = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val, silent</span>) </span>{
          self.doc.translate.y = val;
          self.doc.translate.ty = (val * <span class="hljs-number">-1</span>) + <span class="hljs-string">"px"</span>;
          self.doc.css(cap.trstyle, <span class="hljs-string">"translate("</span> + self.doc.translate.tx + <span class="hljs-string">","</span> + self.doc.translate.ty + <span class="hljs-string">")"</span>);
          <span class="hljs-keyword">if</span> (!silent) self.notifyScrollEvent(self.win[<span class="hljs-number">0</span>]);
        };
        <span class="hljs-keyword">this</span>.setScrollLeft = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val, silent</span>) </span>{
          self.doc.translate.x = val;
          self.doc.translate.tx = (val * cxscrollleft) + <span class="hljs-string">"px"</span>;
          self.doc.css(cap.trstyle, <span class="hljs-string">"translate("</span> + self.doc.translate.tx + <span class="hljs-string">","</span> + self.doc.translate.ty + <span class="hljs-string">")"</span>);
          <span class="hljs-keyword">if</span> (!silent) self.notifyScrollEvent(self.win[<span class="hljs-number">0</span>]);
        };
      }
    } <span class="hljs-keyword">else</span> {    <span class="hljs-comment">// native scroll</span>

      <span class="hljs-keyword">this</span>.getScrollTop = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> self.docscroll.scrollTop();
      };
      <span class="hljs-keyword">this</span>.setScrollTop = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{
        self.docscroll.scrollTop(val);
      };

      <span class="hljs-keyword">this</span>.getScrollLeft = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> val;
        <span class="hljs-keyword">if</span> (!self.hasreversehr) {
          val = self.docscroll.scrollLeft();
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (self.detected.ismozilla) {
          val = self.page.maxw - <span class="hljs-built_in">Math</span>.abs(self.docscroll.scrollLeft());
        } <span class="hljs-keyword">else</span> {
          val = self.page.maxw - self.docscroll.scrollLeft();
        }
        <span class="hljs-keyword">return</span> val;
      };
      <span class="hljs-keyword">this</span>.setScrollLeft = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{
        <span class="hljs-keyword">return</span> setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
          <span class="hljs-keyword">if</span> (!self) <span class="hljs-keyword">return</span>;
          <span class="hljs-keyword">if</span> (self.hasreversehr) {
            <span class="hljs-keyword">if</span> (self.detected.ismozilla) {
              val = -(self.page.maxw - val);
            } <span class="hljs-keyword">else</span> {
              val = self.page.maxw - val;
            }
          }
          <span class="hljs-keyword">return</span> self.docscroll.scrollLeft(val);
        }, <span class="hljs-number">1</span>);
      };
    }

    <span class="hljs-keyword">this</span>.getTarget = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
      <span class="hljs-keyword">if</span> (!e) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">if</span> (e.target) <span class="hljs-keyword">return</span> e.target;
      <span class="hljs-keyword">if</span> (e.srcElement) <span class="hljs-keyword">return</span> e.srcElement;
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    };

    <span class="hljs-keyword">this</span>.hasParent = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e, id</span>) </span>{
      <span class="hljs-keyword">if</span> (!e) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">var</span> el = e.target || e.srcElement || e || <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">while</span> (el &amp;&amp; el.id != id) {
        el = el.parentNode || <span class="hljs-literal">false</span>;
      }
      <span class="hljs-keyword">return</span> (el !== <span class="hljs-literal">false</span>);
    };

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getZIndex</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> dom = self.win;
      <span class="hljs-keyword">if</span> (<span class="hljs-string">"zIndex"</span> <span class="hljs-keyword">in</span> dom) <span class="hljs-keyword">return</span> dom.zIndex(); <span class="hljs-comment">// use jQuery UI method when available</span>
      <span class="hljs-keyword">while</span> (dom.length &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">if</span> (dom[<span class="hljs-number">0</span>].nodeType == <span class="hljs-number">9</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">var</span> zi = dom.css(<span class="hljs-string">'zIndex'</span>);
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">isNaN</span>(zi) &amp;&amp; zi !== <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseInt</span>(zi);
        dom = dom.parent();
      }
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>inspired by http://forum.jquery.com/topic/width-includes-border-width-when-set-to-thin-medium-thick-in-ie</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">var</span> _convertBorderWidth = {
      <span class="hljs-string">"thin"</span>: <span class="hljs-number">1</span>,
      <span class="hljs-string">"medium"</span>: <span class="hljs-number">3</span>,
      <span class="hljs-string">"thick"</span>: <span class="hljs-number">5</span>
    };

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getWidthToPixel</span>(<span class="hljs-params">dom, prop, chkheight</span>) </span>{
      <span class="hljs-keyword">var</span> wd = dom.css(prop);
      <span class="hljs-keyword">var</span> px = <span class="hljs-built_in">parseFloat</span>(wd);
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isNaN</span>(px)) {
        px = _convertBorderWidth[wd] || <span class="hljs-number">0</span>;
        <span class="hljs-keyword">var</span> brd = (px == <span class="hljs-number">3</span>) ? ((chkheight) ? (self.win.outerHeight() - self.win.innerHeight()) : (self.win.outerWidth() - self.win.innerWidth())) : <span class="hljs-number">1</span>; <span class="hljs-comment">//DON'T TRUST CSS</span>
        <span class="hljs-keyword">if</span> (self.isie8 &amp;&amp; px) px += <span class="hljs-number">1</span>;
        <span class="hljs-keyword">return</span> (brd) ? px : <span class="hljs-number">0</span>;
      }
      <span class="hljs-keyword">return</span> px;
    }

    <span class="hljs-keyword">this</span>.getDocumentScrollOffset = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">top</span>: _win.pageYOffset || _doc.documentElement.scrollTop,
        <span class="hljs-attr">left</span>: _win.pageXOffset || _doc.documentElement.scrollLeft
      };
    };

    <span class="hljs-keyword">this</span>.getOffset = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">if</span> (self.isfixed) {
        <span class="hljs-keyword">var</span> ofs = self.win.offset();  <span class="hljs-comment">// fix Chrome auto issue (when right/bottom props only)</span>
        <span class="hljs-keyword">var</span> scrl = self.getDocumentScrollOffset();
        ofs.top -= scrl.top;
        ofs.left -= scrl.left;
        <span class="hljs-keyword">return</span> ofs;
      }
      <span class="hljs-keyword">var</span> ww = self.win.offset();
      <span class="hljs-keyword">if</span> (!self.viewport) <span class="hljs-keyword">return</span> ww;
      <span class="hljs-keyword">var</span> vp = self.viewport.offset();
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">top</span>: ww.top - vp.top,
        <span class="hljs-attr">left</span>: ww.left - vp.left
      };
    };

    <span class="hljs-keyword">this</span>.updateScrollBar = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">len</span>) </span>{
      <span class="hljs-keyword">var</span> pos, off;
      <span class="hljs-keyword">if</span> (self.ishwscroll) {
        self.rail.css({
          <span class="hljs-attr">height</span>: self.win.innerHeight() - (opt.railpadding.top + opt.railpadding.bottom)
        });
        <span class="hljs-keyword">if</span> (self.railh) self.railh.css({
          <span class="hljs-attr">width</span>: self.win.innerWidth() - (opt.railpadding.left + opt.railpadding.right)
        });
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">var</span> wpos = self.getOffset();
        pos = {
          <span class="hljs-attr">top</span>: wpos.top,
          <span class="hljs-attr">left</span>: wpos.left - (opt.railpadding.left + opt.railpadding.right)
        };
        pos.top += getWidthToPixel(self.win, <span class="hljs-string">'border-top-width'</span>, <span class="hljs-literal">true</span>);
        pos.left += (self.rail.align) ? self.win.outerWidth() - getWidthToPixel(self.win, <span class="hljs-string">'border-right-width'</span>) - self.rail.width : getWidthToPixel(self.win, <span class="hljs-string">'border-left-width'</span>);

        off = opt.railoffset;
        <span class="hljs-keyword">if</span> (off) {
          <span class="hljs-keyword">if</span> (off.top) pos.top += off.top;
          <span class="hljs-keyword">if</span> (off.left) pos.left += off.left;
        }

        <span class="hljs-keyword">if</span> (!self.railslocked) self.rail.css({
          <span class="hljs-attr">top</span>: pos.top,
          <span class="hljs-attr">left</span>: pos.left,
          <span class="hljs-attr">height</span>: ((len) ? len.h : self.win.innerHeight()) - (opt.railpadding.top + opt.railpadding.bottom)
        });

        <span class="hljs-keyword">if</span> (self.zoom) {
          self.zoom.css({
            <span class="hljs-attr">top</span>: pos.top + <span class="hljs-number">1</span>,
            <span class="hljs-attr">left</span>: (self.rail.align == <span class="hljs-number">1</span>) ? pos.left - <span class="hljs-number">20</span> : pos.left + self.rail.width + <span class="hljs-number">4</span>
          });
        }

        <span class="hljs-keyword">if</span> (self.railh &amp;&amp; !self.railslocked) {
          pos = {
            <span class="hljs-attr">top</span>: wpos.top,
            <span class="hljs-attr">left</span>: wpos.left
          };
          off = opt.railhoffset;
          <span class="hljs-keyword">if</span> (off) {
            <span class="hljs-keyword">if</span> (off.top) pos.top += off.top;
            <span class="hljs-keyword">if</span> (off.left) pos.left += off.left;
          }
          <span class="hljs-keyword">var</span> y = (self.railh.align) ? pos.top + getWidthToPixel(self.win, <span class="hljs-string">'border-top-width'</span>, <span class="hljs-literal">true</span>) + self.win.innerHeight() - self.railh.height : pos.top + getWidthToPixel(self.win, <span class="hljs-string">'border-top-width'</span>, <span class="hljs-literal">true</span>);
          <span class="hljs-keyword">var</span> x = pos.left + getWidthToPixel(self.win, <span class="hljs-string">'border-left-width'</span>);
          self.railh.css({
            <span class="hljs-attr">top</span>: y - (opt.railpadding.top + opt.railpadding.bottom),
            <span class="hljs-attr">left</span>: x,
            <span class="hljs-attr">width</span>: self.railh.width
          });
        }

      }
    };

    <span class="hljs-keyword">this</span>.doRailClick = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e, dbl, hr</span>) </span>{
      <span class="hljs-keyword">var</span> fn, pg, cur, pos;

      <span class="hljs-keyword">if</span> (self.railslocked) <span class="hljs-keyword">return</span>;

      self.cancelEvent(e);

      <span class="hljs-keyword">if</span> (!(<span class="hljs-string">"pageY"</span> <span class="hljs-keyword">in</span> e)) {
        e.pageX = e.clientX + _doc.documentElement.scrollLeft;
        e.pageY = e.clientY + _doc.documentElement.scrollTop;
      }

      <span class="hljs-keyword">if</span> (dbl) {
        fn = (hr) ? self.doScrollLeft : self.doScrollTop;
        cur = (hr) ? ((e.pageX - self.railh.offset().left - (self.cursorwidth / <span class="hljs-number">2</span>)) * self.scrollratio.x) : ((e.pageY - self.rail.offset().top - (self.cursorheight / <span class="hljs-number">2</span>)) * self.scrollratio.y);
        self.unsynched(<span class="hljs-string">"relativexy"</span>);
        fn(cur|<span class="hljs-number">0</span>);
      } <span class="hljs-keyword">else</span> {
        fn = (hr) ? self.doScrollLeftBy : self.doScrollBy;
        cur = (hr) ? self.scroll.x : self.scroll.y;
        pos = (hr) ? e.pageX - self.railh.offset().left : e.pageY - self.rail.offset().top;
        pg = (hr) ? self.view.w : self.view.h;
        fn((cur &gt;= pos) ? pg : -pg);
      }

    };

    self.newscrolly = self.newscrollx = <span class="hljs-number">0</span>;

    self.hasanimationframe = (<span class="hljs-string">"requestAnimationFrame"</span> <span class="hljs-keyword">in</span> _win);
    self.hascancelanimationframe = (<span class="hljs-string">"cancelAnimationFrame"</span> <span class="hljs-keyword">in</span> _win);

    self.hasborderbox = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">this</span>.init = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

      self.saved.css = [];

      <span class="hljs-keyword">if</span> (cap.isoperamini) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// SORRY, DO NOT WORK!</span>
      <span class="hljs-keyword">if</span> (cap.isandroid &amp;&amp; !(<span class="hljs-string">"hidden"</span> <span class="hljs-keyword">in</span> _doc)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// Android 3- SORRY, DO NOT WORK!</span>

      opt.emulatetouch = opt.emulatetouch || opt.touchbehavior;  <span class="hljs-comment">// mantain compatibility with "touchbehavior"      </span>

      self.hasborderbox = _win.getComputedStyle &amp;&amp; (_win.getComputedStyle(_doc.body)[<span class="hljs-string">'box-sizing'</span>] === <span class="hljs-string">"border-box"</span>);

      <span class="hljs-keyword">var</span> _scrollyhidden = { <span class="hljs-string">'overflow-y'</span>: <span class="hljs-string">'hidden'</span> };
      <span class="hljs-keyword">if</span> (cap.isie11 || cap.isie10) _scrollyhidden[<span class="hljs-string">'-ms-overflow-style'</span>] = <span class="hljs-string">'none'</span>;  <span class="hljs-comment">// IE 10 &amp; 11 is always a world apart!</span>

      <span class="hljs-keyword">if</span> (self.ishwscroll) {
        <span class="hljs-keyword">this</span>.doc.css(cap.transitionstyle, cap.prefixstyle + <span class="hljs-string">'transform 0ms ease-out'</span>);
        <span class="hljs-keyword">if</span> (cap.transitionend) self.bind(self.doc, cap.transitionend, self.onScrollTransitionEnd, <span class="hljs-literal">false</span>); <span class="hljs-comment">//I have got to do something usefull!!</span>
      }

      self.zindex = <span class="hljs-string">"auto"</span>;
      <span class="hljs-keyword">if</span> (!self.ispage &amp;&amp; opt.zindex == <span class="hljs-string">"auto"</span>) {
        self.zindex = getZIndex() || <span class="hljs-string">"auto"</span>;
      } <span class="hljs-keyword">else</span> {
        self.zindex = opt.zindex;
      }

      <span class="hljs-keyword">if</span> (!self.ispage &amp;&amp; self.zindex != <span class="hljs-string">"auto"</span> &amp;&amp; self.zindex &gt; globalmaxzindex) {
        globalmaxzindex = self.zindex;
      }

      <span class="hljs-keyword">if</span> (self.isie &amp;&amp; self.zindex === <span class="hljs-number">0</span> &amp;&amp; opt.zindex == <span class="hljs-string">"auto"</span>) { <span class="hljs-comment">// fix IE auto == 0</span>
        self.zindex = <span class="hljs-string">"auto"</span>;
      }

      <span class="hljs-keyword">if</span> (!self.ispage || !cap.isieold) {

        <span class="hljs-keyword">var</span> cont = self.docscroll;
        <span class="hljs-keyword">if</span> (self.ispage) cont = (self.haswrapper) ? self.win : self.doc;

        self.css(cont, _scrollyhidden);

        <span class="hljs-keyword">if</span> (self.ispage &amp;&amp; (cap.isie11 || cap.isie)) { <span class="hljs-comment">// IE 7-11</span>
          self.css($(<span class="hljs-string">"html"</span>), _scrollyhidden);
        }

        <span class="hljs-keyword">if</span> (cap.isios &amp;&amp; !self.ispage &amp;&amp; !self.haswrapper) self.css($body, {
          <span class="hljs-string">"-webkit-overflow-scrolling"</span>: <span class="hljs-string">"touch"</span>
        }); <span class="hljs-comment">//force hw acceleration</span>

        <span class="hljs-keyword">var</span> cursor = $(_doc.createElement(<span class="hljs-string">'div'</span>));
        cursor.css({
          <span class="hljs-attr">position</span>: <span class="hljs-string">"relative"</span>,
          <span class="hljs-attr">top</span>: <span class="hljs-number">0</span>,
          <span class="hljs-string">"float"</span>: <span class="hljs-string">"right"</span>,
          <span class="hljs-attr">width</span>: opt.cursorwidth,
          <span class="hljs-attr">height</span>: <span class="hljs-number">0</span>,
          <span class="hljs-string">'background-color'</span>: opt.cursorcolor,
          <span class="hljs-attr">border</span>: opt.cursorborder,
          <span class="hljs-string">'background-clip'</span>: <span class="hljs-string">'padding-box'</span>,
          <span class="hljs-string">'-webkit-border-radius'</span>: opt.cursorborderradius,
          <span class="hljs-string">'-moz-border-radius'</span>: opt.cursorborderradius,
          <span class="hljs-string">'border-radius'</span>: opt.cursorborderradius
        });

        cursor.addClass(<span class="hljs-string">'nicescroll-cursors'</span>);

        self.cursor = cursor;

        <span class="hljs-keyword">var</span> rail = $(_doc.createElement(<span class="hljs-string">'div'</span>));
        rail.attr(<span class="hljs-string">'id'</span>, self.id);
        rail.addClass(<span class="hljs-string">'nicescroll-rails nicescroll-rails-vr'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<div class="dox">
<div class="summary">
<p>var v, a, kp = [&quot;left&quot;, &quot;right&quot;, &quot;top&quot;, &quot;bottom&quot;];  /<br>
for (var n in kp) {
a = kp[n];
v = opt.railpadding[a] || 0;
v &amp;&amp; rail.css(&quot;padding-&quot; + a, v + &quot;px&quot;);
}</p>
<p>rail.append(cursor);</p>
<p>rail.width = Math.max(parseFloat(opt.cursorwidth), cursor.outerWidth());
rail.css({
width: rail.width + &quot;px&quot;,
zIndex: self.zindex,
background: opt.background,
cursor: &quot;default&quot;
});</p>
<p>rail.visibility = true;
rail.scrollable = true;</p>
<p>rail.align = (opt.railalign == &quot;left&quot;) ? 0 : 1;</p>
<p>self.rail = rail;</p>
<p>self.rail.drag = false;</p>
<p>var zoom = false;
if (opt.boxzoom &amp;&amp; !self.ispage &amp;&amp; !cap.isieold) {
zoom = _doc.createElement('div');</p>
<p>self.bind(zoom, &quot;click&quot;, self.doZoom);
self.bind(zoom, &quot;mouseenter&quot;, function () {
self.zoom.css('opacity', opt.cursoropacitymax);
});
self.bind(zoom, &quot;mouseleave&quot;, function () {
self.zoom.css('opacity', opt.cursoropacitymin);
});</p>
<p>self.zoom = $(zoom);
self.zoom.css({
cursor: &quot;pointer&quot;,
zIndex: self.zindex,
backgroundImage: 'url(' + opt.scriptpath + 'zoomico.png)',
height: 18,
width: 18,
backgroundPosition: '0 0'
});
if (opt.dblclickzoom) self.bind(self.win, &quot;dblclick&quot;, self.doZoom);
if (cap.cantouch &amp;&amp; opt.gesturezoom) {
self.ongesturezoom = function (e) {
if (e.scale &gt; 1.5) self.doZoomIn(e);
if (e.scale &lt; 0.8) self.doZoomOut(e);
return self.cancelEvent(e);
};
self.bind(self.win, &quot;gestureend&quot;, self.ongesturezoom);
}
}</p>
<p>// init HORIZ</p>
<p>self.railh = false;
var railh;</p>
<p>if (opt.horizrailenabled) {</p>
<p>self.css(cont, {
overflowX: 'hidden'
});</p>
<p>cursor = $(_doc.createElement('div'));
cursor.css({
position: &quot;absolute&quot;,
top: 0,
height: opt.cursorwidth,
width: 0,
backgroundColor: opt.cursorcolor,
border: opt.cursorborder,
backgroundClip: 'padding-box',
'-webkit-border-radius': opt.cursorborderradius,
'-moz-border-radius': opt.cursorborderradius,
'border-radius': opt.cursorborderradius
});</p>
<p>if (cap.isieold) cursor.css('overflow', 'hidden');  //IE6 horiz scrollbar issue</p>
<p>cursor.addClass('nicescroll-cursors');</p>
<p>self.cursorh = cursor;</p>
<p>railh = $(_doc.createElement('div'));
railh.attr('id', self.id + '-hr');
railh.addClass('nicescroll-rails nicescroll-rails-hr');
railh.height = Math.max(parseFloat(opt.cursorwidth), cursor.outerHeight());
railh.css({
height: railh.height + &quot;px&quot;,
'zIndex': self.zindex,
&quot;background&quot;: opt.background
});</p>
<p>railh.append(cursor);</p>
<p>railh.visibility = true;
railh.scrollable = true;</p>
<p>railh.align = (opt.railvalign == &quot;top&quot;) ? 0 : 1;</p>
<p>self.railh = railh;</p>
<p>self.railh.drag = false;</p>
<p>}</p>
<p>if (self.ispage) {</p>
<p>rail.css({
position: &quot;fixed&quot;,
top: 0,
height: &quot;100%&quot;
});</p>
<p>rail.css((rail.align) ? { right: 0 } : { left: 0 });</p>
<p>self.body.append(rail);
if (self.railh) {
railh.css({
position: &quot;fixed&quot;,
left: 0,
width: &quot;100%&quot;
});</p>
<p>railh.css((railh.align) ? { bottom: 0 } : { top: 0 });</p>
<p>self.body.append(railh);
}
} else {
if (self.ishwscroll) {
if (self.win.css('position') == 'static') self.css(self.win, { 'position': 'relative' });
var bd = (self.win[0].nodeName == 'HTML') ? self.body : self.win;
$(bd).scrollTop(0).scrollLeft(0);  // fix rail position if content already scrolled
if (self.zoom) {
self.zoom.css({
position: &quot;absolute&quot;,
top: 1,
right: 0,
&quot;margin-right&quot;: rail.width + 4
});
bd.append(self.zoom);
}
rail.css({
position: &quot;absolute&quot;,
top: 0
});
rail.css((rail.align) ? { right: 0 } : { left: 0 });
bd.append(rail);
if (railh) {
railh.css({
position: &quot;absolute&quot;,
left: 0,
bottom: 0
});
railh.css((railh.align) ? { bottom: 0 } : { top: 0 });
bd.append(railh);
}
} else {
self.isfixed = (self.win.css(&quot;position&quot;) == &quot;fixed&quot;);
var rlpos = (self.isfixed) ? &quot;fixed&quot; : &quot;absolute&quot;;</p>
<p>if (!self.isfixed) self.viewport = self.getViewport(self.win[0]);
if (self.viewport) {
self.body = self.viewport;
if (!(/fixed|absolute/.test(self.viewport.css(&quot;position&quot;)))) self.css(self.viewport, {
&quot;position&quot;: &quot;relative&quot;
});
}</p>
<p>rail.css({
position: rlpos
});
if (self.zoom) self.zoom.css({
position: rlpos
});
self.updateScrollBar();
self.body.append(rail);
if (self.zoom) self.body.append(self.zoom);
if (self.railh) {
railh.css({
position: rlpos
});
self.body.append(railh);
}
}</p>
<p>if (cap.isios) self.css(self.win, {
'-webkit-tap-highlight-color': 'rgba(0,0,0,0)',
'-webkit-touch-callout': 'none'
}); // prevent grey layer on click</p>
<p>if (opt.disableoutline) {
if (cap.isie) self.win.attr(&quot;hideFocus&quot;, &quot;true&quot;); // IE, prevent dotted rectangle on focused div
if (cap.iswebkit) self.win.css('outline', 'none');  // Webkit outline
}</p>
<p>}</p>
<p>if (opt.autohidemode === false) {
self.autohidedom = false;
self.rail.css({
opacity: opt.cursoropacitymax
});
if (self.railh) self.railh.css({
opacity: opt.cursoropacitymax
});
} else if ((opt.autohidemode === true) || (opt.autohidemode === &quot;leave&quot;)) {
self.autohidedom = $().add(self.rail);
if (cap.isie8) self.autohidedom = self.autohidedom.add(self.cursor);
if (self.railh) self.autohidedom = self.autohidedom.add(self.railh);
if (self.railh &amp;&amp; cap.isie8) self.autohidedom = self.autohidedom.add(self.cursorh);
} else if (opt.autohidemode == &quot;scroll&quot;) {
self.autohidedom = $().add(self.rail);
if (self.railh) self.autohidedom = self.autohidedom.add(self.railh);
} else if (opt.autohidemode == &quot;cursor&quot;) {
self.autohidedom = $().add(self.cursor);
if (self.railh) self.autohidedom = self.autohidedom.add(self.cursorh);
} else if (opt.autohidemode == &quot;hidden&quot;) {
self.autohidedom = false;
self.hide();
self.railslocked = false;
}</p>
<p>if (cap.cantouch || self.istouchcapable || opt.emulatetouch || cap.hasmstouch) {</p>
<p>self.scrollmom = new ScrollMomentumClass2D(self);</p>
<p>var delayedclick = null;</p>
<p>self.ontouchstart = function (e) {</p>
<p>if (self.locked) return false;</p>
<p>//if (e.pointerType &amp;&amp; e.pointerType != 2 &amp;&amp; e.pointerType != &quot;touch&quot;) return false;
if (e.pointerType &amp;&amp; (e.pointerType === 'mouse' || e.pointerType === e.MSPOINTER_TYPE_MOUSE)) return false;  // need test on surface!!</p>
<p>self.hasmoving = false;</p>
<p>if (self.scrollmom.timer) {
self.triggerScrollEnd();
self.scrollmom.stop();
}</p>
<p>if (!self.railslocked) {
var tg = self.getTarget(e);</p>
<p>if (tg) {
var skp = (/INPUT/i.test(tg.nodeName)) &amp;&amp; (/range/i.test(tg.type));
if (skp) return self.stopPropagation(e);
}</p>
<p>var ismouse = (e.type === &quot;mousedown&quot;);</p>
<p>if (!(&quot;clientX&quot; in e) &amp;&amp; (&quot;changedTouches&quot; in e)) {
e.clientX = e.changedTouches[0].clientX;
e.clientY = e.changedTouches[0].clientY;
}</p>
<p>if (self.forcescreen) {
var le = e;
e = {
&quot;original&quot;: (e.original) ? e.original : e
};
e.clientX = le.screenX;
e.clientY = le.screenY;
}</p>
<p>self.rail.drag = {
x: e.clientX,
y: e.clientY,
sx: self.scroll.x,
sy: self.scroll.y,
st: self.getScrollTop(),
sl: self.getScrollLeft(),
pt: 2,
dl: false,
tg: tg
};</p>
<p>if (self.ispage || !opt.directionlockdeadzone) {</p>
<p>self.rail.drag.dl = &quot;f&quot;;</p>
<p>} else {</p>
<p>var view = {
w: $window.width(),
h: $window.height()
};</p>
<p>var page = self.getContentSize();</p>
<p>var maxh = page.h - view.h;
var maxw = page.w - view.w;</p>
<p>if (self.rail.scrollable &amp;&amp; !self.railh.scrollable) self.rail.drag.ck = (maxh &gt; 0) ? &quot;v&quot; : false;
else if (!self.rail.scrollable &amp;&amp; self.railh.scrollable) self.rail.drag.ck = (maxw &gt; 0) ? &quot;h&quot; : false;
else self.rail.drag.ck = false;</p>
<p>}</p>
<p>if (opt.emulatetouch &amp;&amp; self.isiframe &amp;&amp; cap.isie) {
var wp = self.win.position();
self.rail.drag.x += wp.left;
self.rail.drag.y += wp.top;
}</p>
<p>self.hasmoving = false;
self.lastmouseup = false;
self.scrollmom.reset(e.clientX, e.clientY);</p>
<p>if (tg&amp;&amp;ismouse) {</p>
<p>var ip = /INPUT|SELECT|BUTTON|TEXTAREA/i.test(tg.nodeName);
if (!ip) {
if (cap.hasmousecapture) tg.setCapture();
if (opt.emulatetouch) {
if (tg.onclick &amp;&amp; !(tg._onclick || false)) { // intercept DOM0 onclick event
tg._onclick = tg.onclick;
tg.onclick = function (e) {
if (self.hasmoving) return false;
tg._onclick.call(this, e);
};
}
return self.cancelEvent(e);
}
return self.stopPropagation(e);
}</p>
<p>if (/SUBMIT|CANCEL|BUTTON/i.test($(tg).attr('type'))) {
self.preventclick = {
&quot;tg&quot;: tg,
&quot;click&quot;: false
};
}</p>
<p>}
}</p>
<p>};</p>
<p>self.ontouchend = function (e) {</p>
<p>if (!self.rail.drag) return true;</p>
<p>if (self.rail.drag.pt == 2) {
//if (e.pointerType &amp;&amp; e.pointerType != 2 &amp;&amp; e.pointerType != &quot;touch&quot;) return false;
if (e.pointerType &amp;&amp; (e.pointerType === 'mouse' || e.pointerType === e.MSPOINTER_TYPE_MOUSE)) return false;</p>
<p>self.rail.drag = false;</p>
<p>var ismouse = (e.type === &quot;mouseup&quot;);</p>
<p>if (self.hasmoving) {
self.scrollmom.doMomentum();
self.lastmouseup = true;
self.hideCursor();
if (cap.hasmousecapture) _doc.releaseCapture();
if (ismouse) return self.cancelEvent(e);
}</p>
<p>}
else if (self.rail.drag.pt == 1) {
return self.onmouseup(e);
}</p>
<p>};</p>
<p>var moveneedoffset = (opt.emulatetouch &amp;&amp; self.isiframe &amp;&amp; !cap.hasmousecapture);</p>
<p>var locktollerance = opt.directionlockdeadzone * 0.3 | 0;</p>
<p>self.ontouchmove = function (e, byiframe) {</p>
<p>if (!self.rail.drag) return true;</p>
<p>if (e.targetTouches &amp;&amp; opt.preventmultitouchscrolling) {
if (e.targetTouches.length &gt; 1) return true; // multitouch
}</p>
<p>//if (e.pointerType &amp;&amp; e.pointerType != 2 &amp;&amp; e.pointerType != &quot;touch&quot;) return false;
if (e.pointerType &amp;&amp; (e.pointerType === 'mouse' || e.pointerType === e.MSPOINTER_TYPE_MOUSE)) return true;</p>
<p>if (self.rail.drag.pt == 2) {</p>
<p>if ((&quot;changedTouches&quot; in e)) {
e.clientX = e.changedTouches[0].clientX;
e.clientY = e.changedTouches[0].clientY;
}</p>
<p>var ofy, ofx;
ofx = ofy = 0;</p>
<p>if (moveneedoffset &amp;&amp; !byiframe) {
var wp = self.win.position();
ofx = -wp.left;
ofy = -wp.top;
}</p>
<p>var fy = e.clientY + ofy;
var my = (fy - self.rail.drag.y);
var fx = e.clientX + ofx;
var mx = (fx - self.rail.drag.x);</p>
<p>var ny = self.rail.drag.st - my;</p>
<p>if (self.ishwscroll &amp;&amp; opt.bouncescroll) {
if (ny &lt; 0) {
ny = Math.round(ny / 2);
} else if (ny &gt; self.page.maxh) {
ny = self.page.maxh + Math.round((ny - self.page.maxh) / 2);
}
} else {
if (ny &lt; 0) {
ny = 0;
fy = 0;
}
else if (ny &gt; self.page.maxh) {
ny = self.page.maxh;
fy = 0;
}
if (fy === 0 &amp;&amp; !self.hasmoving) {
if (!self.ispage) self.rail.drag = false;
return true;
}
}</p>
<p>var nx = self.getScrollLeft();</p>
<p>if (self.railh &amp;&amp; self.railh.scrollable) {
nx = (self.isrtlmode) ? mx - self.rail.drag.sl : self.rail.drag.sl - mx;</p>
<p>if (self.ishwscroll &amp;&amp; opt.bouncescroll) {
if (nx &lt; 0) {
nx = Math.round(nx / 2);
} else if (nx &gt; self.page.maxw) {
nx = self.page.maxw + Math.round((nx - self.page.maxw) / 2);
}
} else {
if (nx &lt; 0) {
nx = 0;
fx = 0;
}
if (nx &gt; self.page.maxw) {
nx = self.page.maxw;
fx = 0;
}
}</p>
<p>}</p>
<p>if (!self.hasmoving) {</p>
<p>if (self.rail.drag.y === e.clientY &amp;&amp; self.rail.drag.x === e.clientX) return self.cancelEvent(e);  // prevent first useless move event</p>
<p>var ay = Math.abs(my);
var ax = Math.abs(mx);
var dz = opt.directionlockdeadzone;</p>
<p>if (!self.rail.drag.ck) {
if (ay &gt; dz &amp;&amp; ax &gt; dz) self.rail.drag.dl = &quot;f&quot;;
else if (ay &gt; dz) self.rail.drag.dl = (ax &gt; locktollerance) ? &quot;f&quot; : &quot;v&quot;;
else if (ax &gt; dz) self.rail.drag.dl = (ay &gt; locktollerance) ? &quot;f&quot; : &quot;h&quot;;
}
else if (self.rail.drag.ck == &quot;v&quot;) {
if (ax &gt; dz &amp;&amp; ay &lt;= locktollerance) {
self.rail.drag = false;
}
else if (ay &gt; dz) self.rail.drag.dl = &quot;v&quot;;</p>
<p>}
else if (self.rail.drag.ck == &quot;h&quot;) {</p>
<p>if (ay &gt; dz &amp;&amp; ax &lt;= locktollerance) {
self.rail.drag = false;
}
else if (ax &gt; dz) self.rail.drag.dl = &quot;h&quot;;</p>
<p>}</p>
<p>if (!self.rail.drag.dl) return self.cancelEvent(e);</p>
<p>self.triggerScrollStart(e.clientX, e.clientY, 0, 0, 0);
self.hasmoving = true;
}</p>
<p>if (self.preventclick &amp;&amp; !self.preventclick.click) {
self.preventclick.click = self.preventclick.tg.onclick || false;
self.preventclick.tg.onclick = self.onpreventclick;
}</p>
<p>if (self.rail.drag.dl) {
if (self.rail.drag.dl == &quot;v&quot;) nx = self.rail.drag.sl;
else if (self.rail.drag.dl == &quot;h&quot;) ny = self.rail.drag.st;
}</p>
<p>self.synched(&quot;touchmove&quot;, function () {
if (self.rail.drag &amp;&amp; (self.rail.drag.pt == 2)) {
if (self.prepareTransition) self.resetTransition();
if (self.rail.scrollable) self.setScrollTop(ny);
self.scrollmom.update(fx, fy);
if (self.railh &amp;&amp; self.railh.scrollable) {
self.setScrollLeft(nx);
self.showCursor(ny, nx);
} else {
self.showCursor(ny);
}
if (cap.isie10) _doc.selection.clear();
}
});</p>
<p>return self.cancelEvent(e);</p>
<p>}
else if (self.rail.drag.pt == 1) { // drag on cursor
return self.onmousemove(e);
}</p>
<p>};</p>
<p>self.ontouchstartCursor = function (e, hronly) {
if (self.rail.drag &amp;&amp; self.rail.drag.pt != 3) return;
if (self.locked) return self.cancelEvent(e);
self.cancelScroll();
self.rail.drag = {
x: e.touches[0].clientX,
y: e.touches[0].clientY,
sx: self.scroll.x,
sy: self.scroll.y,
pt: 3,
hr: (!!hronly)
};
var tg = self.getTarget(e);
if (!self.ispage &amp;&amp; cap.hasmousecapture) tg.setCapture();
if (self.isiframe &amp;&amp; !cap.hasmousecapture) {
self.saved.csspointerevents = self.doc.css(&quot;pointer-events&quot;);
self.css(self.doc, { &quot;pointer-events&quot;: &quot;none&quot; });
}
return self.cancelEvent(e);
};</p>
<p>self.ontouchendCursor = function (e) {
if (self.rail.drag) {
if (cap.hasmousecapture) _doc.releaseCapture();
if (self.isiframe &amp;&amp; !cap.hasmousecapture) self.doc.css(&quot;pointer-events&quot;, self.saved.csspointerevents);
if (self.rail.drag.pt != 3) return;
self.rail.drag = false;
return self.cancelEvent(e);
}
};</p>
<p>self.ontouchmoveCursor = function (e) {
if (self.rail.drag) {
if (self.rail.drag.pt != 3) return;</p>
<p>self.cursorfreezed = true;</p>
<p>if (self.rail.drag.hr) {
self.scroll.x = self.rail.drag.sx + (e.touches[0].clientX - self.rail.drag.x);
if (self.scroll.x &lt; 0) self.scroll.x = 0;
var mw = self.scrollvaluemaxw;
if (self.scroll.x &gt; mw) self.scroll.x = mw;
} else {
self.scroll.y = self.rail.drag.sy + (e.touches[0].clientY - self.rail.drag.y);
if (self.scroll.y &lt; 0) self.scroll.y = 0;
var my = self.scrollvaluemax;
if (self.scroll.y &gt; my) self.scroll.y = my;
}</p>
<p>self.synched('touchmove', function () {
if (self.rail.drag &amp;&amp; (self.rail.drag.pt == 3)) {
self.showCursor();
if (self.rail.drag.hr) self.doScrollLeft(Math.round(self.scroll.x * self.scrollratio.x), opt.cursordragspeed);
else self.doScrollTop(Math.round(self.scroll.y * self.scrollratio.y), opt.cursordragspeed);
}
});</p>
<p>return self.cancelEvent(e);
}</p>
<p>};</p>
<p>}</p>
<p>self.onmousedown = function (e, hronly) {
if (self.rail.drag &amp;&amp; self.rail.drag.pt != 1) return;
if (self.railslocked) return self.cancelEvent(e);
self.cancelScroll();
self.rail.drag = {
x: e.clientX,
y: e.clientY,
sx: self.scroll.x,
sy: self.scroll.y,
pt: 1,
hr: hronly || false
};
var tg = self.getTarget(e);</p>
<p>if (cap.hasmousecapture) tg.setCapture();
if (self.isiframe &amp;&amp; !cap.hasmousecapture) {
self.saved.csspointerevents = self.doc.css(&quot;pointer-events&quot;);
self.css(self.doc, {
&quot;pointer-events&quot;: &quot;none&quot;
});
}
self.hasmoving = false;
return self.cancelEvent(e);
};</p>
<p>self.onmouseup = function (e) {
if (self.rail.drag) {
if (self.rail.drag.pt != 1) return true;</p>
<p>if (cap.hasmousecapture) _doc.releaseCapture();
if (self.isiframe &amp;&amp; !cap.hasmousecapture) self.doc.css(&quot;pointer-events&quot;, self.saved.csspointerevents);
self.rail.drag = false;
self.cursorfreezed = false;
if (self.hasmoving) self.triggerScrollEnd();
return self.cancelEvent(e);
}
};</p>
<p>self.onmousemove = function (e) {
if (self.rail.drag) {
if (self.rail.drag.pt !== 1) return;</p>
<p>if (cap.ischrome &amp;&amp; e.which === 0) return self.onmouseup(e);</p>
<p>self.cursorfreezed = true;</p>
<p>if (!self.hasmoving) self.triggerScrollStart(e.clientX, e.clientY, 0, 0, 0);</p>
<p>self.hasmoving = true;</p>
<p>if (self.rail.drag.hr) {
self.scroll.x = self.rail.drag.sx + (e.clientX - self.rail.drag.x);
if (self.scroll.x &lt; 0) self.scroll.x = 0;
var mw = self.scrollvaluemaxw;
if (self.scroll.x &gt; mw) self.scroll.x = mw;
} else {
self.scroll.y = self.rail.drag.sy + (e.clientY - self.rail.drag.y);
if (self.scroll.y &lt; 0) self.scroll.y = 0;
var my = self.scrollvaluemax;
if (self.scroll.y &gt; my) self.scroll.y = my;
}</p>
<p>self.synched('mousemove', function () {</p>
<p>if (self.cursorfreezed) {
self.showCursor();</p>
<p>if (self.rail.drag.hr) {
self.scrollLeft(Math.round(self.scroll.x * self.scrollratio.x));
} else {
self.scrollTop(Math.round(self.scroll.y * self.scrollratio.y));
}</p>
<p>}
});</p>
<p>return self.cancelEvent(e);
}
else {
self.checkarea = 0;
}
};</p>
<p>if (cap.cantouch || opt.emulatetouch) {</p>
<p>self.onpreventclick = function (e) {
if (self.preventclick) {
self.preventclick.tg.onclick = self.preventclick.click;
self.preventclick = false;
return self.cancelEvent(e);
}
};</p>
<p>self.onclick = (cap.isios) ? false : function (e) {  // it needs to check IE11 ???
if (self.lastmouseup) {
self.lastmouseup = false;
return self.cancelEvent(e);
} else {
return true;
}
};</p>
<p>if (opt.grabcursorenabled &amp;&amp; cap.cursorgrabvalue) {
self.css((self.ispage) ? self.doc : self.win, {
'cursor': cap.cursorgrabvalue
});
self.css(self.rail, {
'cursor': cap.cursorgrabvalue
});
}</p>
<p>} else {</p>
<p>var checkSelectionScroll = function (e) {
if (!self.selectiondrag) return;</p>
<p>if (e) {
var ww = self.win.outerHeight();
var df = (e.pageY - self.selectiondrag.top);
if (df &gt; 0 &amp;&amp; df &lt; ww) df = 0;
if (df &gt;= ww) df -= ww;
self.selectiondrag.df = df;
}
if (self.selectiondrag.df === 0) return;</p>
<p>var rt = -(self.selectiondrag.df*2/6)|0;
self.doScrollBy(rt);</p>
<p>self.debounced(&quot;doselectionscroll&quot;, function () {
checkSelectionScroll();
}, 50);
};</p>
<p>if (&quot;getSelection&quot; in _doc) { // A grade - Major browsers
self.hasTextSelected = function () {
return (_doc.getSelection().rangeCount &gt; 0);
};
} else if (&quot;selection&quot; in _doc) { //IE9-
self.hasTextSelected = function () {
return (_doc.selection.type != &quot;None&quot;);
};
} else {
self.hasTextSelected = function () { // no support
return false;
};
}</p>
<p>self.onselectionstart = function (e) {
//  More testing - severe chrome issues<br>
/*
if (!self.haswrapper&amp;&amp;(e.which&amp;&amp;e.which==2)) {  // fool browser to manage middle button scrolling
self.win.css({'overflow':'auto'});
setTimeout(function(){
self.win.css({'overflow':'hidden'});
},10);<br>
return true;
}</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">if</span> (self.ispage) <span class="hljs-keyword">return</span>;
            self.selectiondrag = self.win.offset();
          };

          self.onselectionend = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
            self.selectiondrag = <span class="hljs-literal">false</span>;
          };
          self.onselectiondrag = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
            <span class="hljs-keyword">if</span> (!self.selectiondrag) <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">if</span> (self.hasTextSelected()) self.debounced(<span class="hljs-string">"selectionscroll"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
              checkSelectionScroll(e);
            }, <span class="hljs-number">250</span>);
          };
        }

        <span class="hljs-keyword">if</span> (cap.hasw3ctouch) { <span class="hljs-comment">//IE11+</span>
          self.css((self.ispage) ? $(<span class="hljs-string">"html"</span>) : self.win, { <span class="hljs-string">'touch-action'</span>: <span class="hljs-string">'none'</span> });
          self.css(self.rail, {
            <span class="hljs-string">'touch-action'</span>: <span class="hljs-string">'none'</span>
          });
          self.css(self.cursor, {
            <span class="hljs-string">'touch-action'</span>: <span class="hljs-string">'none'</span>
          });
          self.bind(self.win, <span class="hljs-string">"pointerdown"</span>, self.ontouchstart);
          self.bind(_doc, <span class="hljs-string">"pointerup"</span>, self.ontouchend);
          self.delegate(_doc, <span class="hljs-string">"pointermove"</span>, self.ontouchmove);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cap.hasmstouch) { <span class="hljs-comment">//IE10</span>
          self.css((self.ispage) ? $(<span class="hljs-string">"html"</span>) : self.win, { <span class="hljs-string">'-ms-touch-action'</span>: <span class="hljs-string">'none'</span> });
          self.css(self.rail, {
            <span class="hljs-string">'-ms-touch-action'</span>: <span class="hljs-string">'none'</span>
          });
          self.css(self.cursor, {
            <span class="hljs-string">'-ms-touch-action'</span>: <span class="hljs-string">'none'</span>
          });
          self.bind(self.win, <span class="hljs-string">"MSPointerDown"</span>, self.ontouchstart);
          self.bind(_doc, <span class="hljs-string">"MSPointerUp"</span>, self.ontouchend);
          self.delegate(_doc, <span class="hljs-string">"MSPointerMove"</span>, self.ontouchmove);
          self.bind(self.cursor, <span class="hljs-string">"MSGestureHold"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
            e.preventDefault();
          });
          self.bind(self.cursor, <span class="hljs-string">"contextmenu"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
            e.preventDefault();
          });
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cap.cantouch) { <span class="hljs-comment">// smartphones/touch devices</span>
          self.bind(self.win, <span class="hljs-string">"touchstart"</span>, self.ontouchstart, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);
          self.bind(_doc, <span class="hljs-string">"touchend"</span>, self.ontouchend, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);
          self.bind(_doc, <span class="hljs-string">"touchcancel"</span>, self.ontouchend, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);
          self.delegate(_doc, <span class="hljs-string">"touchmove"</span>, self.ontouchmove, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);
        }

        <span class="hljs-keyword">if</span> (opt.emulatetouch) {
          self.bind(self.win, <span class="hljs-string">"mousedown"</span>, self.ontouchstart, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);
          self.bind(_doc, <span class="hljs-string">"mouseup"</span>, self.ontouchend, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);
          self.bind(_doc, <span class="hljs-string">"mousemove"</span>, self.ontouchmove, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);
        }

        <span class="hljs-keyword">if</span> (opt.cursordragontouch || (!cap.cantouch &amp;&amp; !opt.emulatetouch)) {

          self.rail.css({
            <span class="hljs-attr">cursor</span>: <span class="hljs-string">"default"</span>
          });
          self.railh &amp;&amp; self.railh.css({
            <span class="hljs-attr">cursor</span>: <span class="hljs-string">"default"</span>
          });

          self.jqbind(self.rail, <span class="hljs-string">"mouseenter"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> (!self.ispage &amp;&amp; !self.win.is(<span class="hljs-string">":visible"</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">if</span> (self.canshowonmouseevent) self.showCursor();
            self.rail.active = <span class="hljs-literal">true</span>;
          });
          self.jqbind(self.rail, <span class="hljs-string">"mouseleave"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            self.rail.active = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">if</span> (!self.rail.drag) self.hideCursor();
          });

          <span class="hljs-keyword">if</span> (opt.sensitiverail) {
            self.bind(self.rail, <span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
              self.doRailClick(e, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);
            });
            self.bind(self.rail, <span class="hljs-string">"dblclick"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
              self.doRailClick(e, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>);
            });
            self.bind(self.cursor, <span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
              self.cancelEvent(e);
            });
            self.bind(self.cursor, <span class="hljs-string">"dblclick"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
              self.cancelEvent(e);
            });
          }

          <span class="hljs-keyword">if</span> (self.railh) {
            self.jqbind(self.railh, <span class="hljs-string">"mouseenter"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
              <span class="hljs-keyword">if</span> (!self.ispage &amp;&amp; !self.win.is(<span class="hljs-string">":visible"</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
              <span class="hljs-keyword">if</span> (self.canshowonmouseevent) self.showCursor();
              self.rail.active = <span class="hljs-literal">true</span>;
            });
            self.jqbind(self.railh, <span class="hljs-string">"mouseleave"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
              self.rail.active = <span class="hljs-literal">false</span>;
              <span class="hljs-keyword">if</span> (!self.rail.drag) self.hideCursor();
            });

            <span class="hljs-keyword">if</span> (opt.sensitiverail) {
              self.bind(self.railh, <span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
                self.doRailClick(e, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);
              });
              self.bind(self.railh, <span class="hljs-string">"dblclick"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
                self.doRailClick(e, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>);
              });
              self.bind(self.cursorh, <span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
                self.cancelEvent(e);
              });
              self.bind(self.cursorh, <span class="hljs-string">"dblclick"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
                self.cancelEvent(e);
              });
            }

          }

        }

        <span class="hljs-keyword">if</span> (opt.cursordragontouch &amp;&amp; (<span class="hljs-keyword">this</span>.istouchcapable || cap.cantouch)) {
          self.bind(self.cursor, <span class="hljs-string">"touchstart"</span>, self.ontouchstartCursor);
          self.bind(self.cursor, <span class="hljs-string">"touchmove"</span>, self.ontouchmoveCursor);
          self.bind(self.cursor, <span class="hljs-string">"touchend"</span>, self.ontouchendCursor);
          self.cursorh &amp;&amp; self.bind(self.cursorh, <span class="hljs-string">"touchstart"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
            self.ontouchstartCursor(e, <span class="hljs-literal">true</span>);
          });
          self.cursorh &amp;&amp; self.bind(self.cursorh, <span class="hljs-string">"touchmove"</span>, self.ontouchmoveCursor);
          self.cursorh &amp;&amp; self.bind(self.cursorh, <span class="hljs-string">"touchend"</span>, self.ontouchendCursor);
        }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<pre><code>   if (!cap.cantouch &amp;&amp; !opt.emulatetouch) {
</code></pre>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> (!opt.emulatetouch &amp;&amp; !cap.isandroid &amp;&amp; !cap.isios) {

          self.bind((cap.hasmousecapture) ? self.win : _doc, <span class="hljs-string">"mouseup"</span>, self.onmouseup);
          self.bind(_doc, <span class="hljs-string">"mousemove"</span>, self.onmousemove);
          <span class="hljs-keyword">if</span> (self.onclick) self.bind(_doc, <span class="hljs-string">"click"</span>, self.onclick);

          self.bind(self.cursor, <span class="hljs-string">"mousedown"</span>, self.onmousedown);
          self.bind(self.cursor, <span class="hljs-string">"mouseup"</span>, self.onmouseup);

          <span class="hljs-keyword">if</span> (self.railh) {
            self.bind(self.cursorh, <span class="hljs-string">"mousedown"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
              self.onmousedown(e, <span class="hljs-literal">true</span>);
            });
            self.bind(self.cursorh, <span class="hljs-string">"mouseup"</span>, self.onmouseup);
          }

          <span class="hljs-keyword">if</span> (!self.ispage &amp;&amp; opt.enablescrollonselection) {
            self.bind(self.win[<span class="hljs-number">0</span>], <span class="hljs-string">"mousedown"</span>, self.onselectionstart);
            self.bind(_doc, <span class="hljs-string">"mouseup"</span>, self.onselectionend);
            self.bind(self.cursor, <span class="hljs-string">"mouseup"</span>, self.onselectionend);
            <span class="hljs-keyword">if</span> (self.cursorh) self.bind(self.cursorh, <span class="hljs-string">"mouseup"</span>, self.onselectionend);
            self.bind(_doc, <span class="hljs-string">"mousemove"</span>, self.onselectiondrag);
          }

          <span class="hljs-keyword">if</span> (self.zoom) {
            self.jqbind(self.zoom, <span class="hljs-string">"mouseenter"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
              <span class="hljs-keyword">if</span> (self.canshowonmouseevent) self.showCursor();
              self.rail.active = <span class="hljs-literal">true</span>;
            });
            self.jqbind(self.zoom, <span class="hljs-string">"mouseleave"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
              self.rail.active = <span class="hljs-literal">false</span>;
              <span class="hljs-keyword">if</span> (!self.rail.drag) self.hideCursor();
            });
          }

        } <span class="hljs-keyword">else</span> {

          self.bind((cap.hasmousecapture) ? self.win : _doc, <span class="hljs-string">"mouseup"</span>, self.ontouchend);
          <span class="hljs-keyword">if</span> (self.onclick) self.bind(_doc, <span class="hljs-string">"click"</span>, self.onclick);

          <span class="hljs-keyword">if</span> (opt.cursordragontouch) {
            self.bind(self.cursor, <span class="hljs-string">"mousedown"</span>, self.onmousedown);
            self.bind(self.cursor, <span class="hljs-string">"mouseup"</span>, self.onmouseup);
            self.cursorh &amp;&amp; self.bind(self.cursorh, <span class="hljs-string">"mousedown"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
              self.onmousedown(e, <span class="hljs-literal">true</span>);
            });
            self.cursorh &amp;&amp; self.bind(self.cursorh, <span class="hljs-string">"mouseup"</span>, self.onmouseup);
          } <span class="hljs-keyword">else</span> {
            self.bind(self.rail, <span class="hljs-string">"mousedown"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{ e.preventDefault(); });  <span class="hljs-comment">// prevent text selection             </span>
            self.railh &amp;&amp; self.bind(self.railh, <span class="hljs-string">"mousedown"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{ e.preventDefault(); });
          }

        }


        <span class="hljs-keyword">if</span> (opt.enablemousewheel) {
          <span class="hljs-keyword">if</span> (!self.isiframe) self.mousewheel((cap.isie &amp;&amp; self.ispage) ? _doc : self.win, self.onmousewheel);
          self.mousewheel(self.rail, self.onmousewheel);
          <span class="hljs-keyword">if</span> (self.railh) self.mousewheel(self.railh, self.onmousewheelhr);
        }

        <span class="hljs-keyword">if</span> (!self.ispage &amp;&amp; !cap.cantouch &amp;&amp; !(<span class="hljs-regexp">/HTML|^BODY/</span>.test(self.win[<span class="hljs-number">0</span>].nodeName))) {
          <span class="hljs-keyword">if</span> (!self.win.attr(<span class="hljs-string">"tabindex"</span>)) self.win.attr({
            <span class="hljs-string">"tabindex"</span>: ++tabindexcounter
          });

          self.bind(self.win, <span class="hljs-string">"focus"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{  <span class="hljs-comment">// better using native events</span>
            domfocus = (self.getTarget(e)).id || self.getTarget(e) || <span class="hljs-literal">false</span>;
            self.hasfocus = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (self.canshowonmouseevent) self.noticeCursor();
          });
          self.bind(self.win, <span class="hljs-string">"blur"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{  <span class="hljs-comment">// *</span>
            domfocus = <span class="hljs-literal">false</span>;
            self.hasfocus = <span class="hljs-literal">false</span>;
          });

          self.bind(self.win, <span class="hljs-string">"mouseenter"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{   <span class="hljs-comment">// *</span>
            mousefocus = (self.getTarget(e)).id || self.getTarget(e) || <span class="hljs-literal">false</span>;
            self.hasmousefocus = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (self.canshowonmouseevent) self.noticeCursor();
          });
          self.bind(self.win, <span class="hljs-string">"mouseleave"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{   <span class="hljs-comment">// *       </span>
            mousefocus = <span class="hljs-literal">false</span>;
            self.hasmousefocus = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">if</span> (!self.rail.drag) self.hideCursor();
          });

        }


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>Thanks to http://www.quirksmode.org !!</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        self.onkeypress = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
          <span class="hljs-keyword">if</span> (self.railslocked &amp;&amp; self.page.maxh === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;

          e = e || _win.event;
          <span class="hljs-keyword">var</span> tg = self.getTarget(e);
          <span class="hljs-keyword">if</span> (tg &amp;&amp; <span class="hljs-regexp">/INPUT|TEXTAREA|SELECT|OPTION/</span>.test(tg.nodeName)) {
            <span class="hljs-keyword">var</span> tp = tg.getAttribute(<span class="hljs-string">'type'</span>) || tg.type || <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">if</span> ((!tp) || !(<span class="hljs-regexp">/submit|button|cancel/i</span>.tp)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
          }

          <span class="hljs-keyword">if</span> ($(tg).attr(<span class="hljs-string">'contenteditable'</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;

          <span class="hljs-keyword">if</span> (self.hasfocus || (self.hasmousefocus &amp;&amp; !domfocus) || (self.ispage &amp;&amp; !domfocus &amp;&amp; !mousefocus)) {
            <span class="hljs-keyword">var</span> key = e.keyCode;

            <span class="hljs-keyword">if</span> (self.railslocked &amp;&amp; key != <span class="hljs-number">27</span>) <span class="hljs-keyword">return</span> self.cancelEvent(e);

            <span class="hljs-keyword">var</span> ctrl = e.ctrlKey || <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">var</span> shift = e.shiftKey || <span class="hljs-literal">false</span>;

            <span class="hljs-keyword">var</span> ret = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">switch</span> (key) {
              <span class="hljs-keyword">case</span> <span class="hljs-number">38</span>:
              <span class="hljs-keyword">case</span> <span class="hljs-number">63233</span>: <span class="hljs-comment">//safari</span>
                self.doScrollBy(<span class="hljs-number">24</span> * <span class="hljs-number">3</span>);
                ret = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">break</span>;
              <span class="hljs-keyword">case</span> <span class="hljs-number">40</span>:
              <span class="hljs-keyword">case</span> <span class="hljs-number">63235</span>: <span class="hljs-comment">//safari</span>
                self.doScrollBy(<span class="hljs-number">-24</span> * <span class="hljs-number">3</span>);
                ret = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">break</span>;
              <span class="hljs-keyword">case</span> <span class="hljs-number">37</span>:
              <span class="hljs-keyword">case</span> <span class="hljs-number">63232</span>: <span class="hljs-comment">//safari</span>
                <span class="hljs-keyword">if</span> (self.railh) {
                  (ctrl) ? self.doScrollLeft(<span class="hljs-number">0</span>) : self.doScrollLeftBy(<span class="hljs-number">24</span> * <span class="hljs-number">3</span>);
                  ret = <span class="hljs-literal">true</span>;
                }
                <span class="hljs-keyword">break</span>;
              <span class="hljs-keyword">case</span> <span class="hljs-number">39</span>:
              <span class="hljs-keyword">case</span> <span class="hljs-number">63234</span>: <span class="hljs-comment">//safari</span>
                <span class="hljs-keyword">if</span> (self.railh) {
                  (ctrl) ? self.doScrollLeft(self.page.maxw) : self.doScrollLeftBy(<span class="hljs-number">-24</span> * <span class="hljs-number">3</span>);
                  ret = <span class="hljs-literal">true</span>;
                }
                <span class="hljs-keyword">break</span>;
              <span class="hljs-keyword">case</span> <span class="hljs-number">33</span>:
              <span class="hljs-keyword">case</span> <span class="hljs-number">63276</span>: <span class="hljs-comment">// safari</span>
                self.doScrollBy(self.view.h);
                ret = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">break</span>;
              <span class="hljs-keyword">case</span> <span class="hljs-number">34</span>:
              <span class="hljs-keyword">case</span> <span class="hljs-number">63277</span>: <span class="hljs-comment">// safari</span>
                self.doScrollBy(-self.view.h);
                ret = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">break</span>;
              <span class="hljs-keyword">case</span> <span class="hljs-number">36</span>:
              <span class="hljs-keyword">case</span> <span class="hljs-number">63273</span>: <span class="hljs-comment">// safari                </span>
                (self.railh &amp;&amp; ctrl) ? self.doScrollPos(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>) : self.doScrollTo(<span class="hljs-number">0</span>);
                ret = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">break</span>;
              <span class="hljs-keyword">case</span> <span class="hljs-number">35</span>:
              <span class="hljs-keyword">case</span> <span class="hljs-number">63275</span>: <span class="hljs-comment">// safari</span>
                (self.railh &amp;&amp; ctrl) ? self.doScrollPos(self.page.maxw, self.page.maxh) : self.doScrollTo(self.page.maxh);
                ret = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">break</span>;
              <span class="hljs-keyword">case</span> <span class="hljs-number">32</span>:
                <span class="hljs-keyword">if</span> (opt.spacebarenabled) {
                  (shift) ? self.doScrollBy(self.view.h) : self.doScrollBy(-self.view.h);
                  ret = <span class="hljs-literal">true</span>;
                }
                <span class="hljs-keyword">break</span>;
              <span class="hljs-keyword">case</span> <span class="hljs-number">27</span>: <span class="hljs-comment">// ESC</span>
                <span class="hljs-keyword">if</span> (self.zoomactive) {
                  self.doZoom();
                  ret = <span class="hljs-literal">true</span>;
                }
                <span class="hljs-keyword">break</span>;
            }
            <span class="hljs-keyword">if</span> (ret) <span class="hljs-keyword">return</span> self.cancelEvent(e);
          }
        };

        <span class="hljs-keyword">if</span> (opt.enablekeyboard) self.bind(_doc, (cap.isopera &amp;&amp; !cap.isopera12) ? <span class="hljs-string">"keypress"</span> : <span class="hljs-string">"keydown"</span>, self.onkeypress);

        self.bind(_doc, <span class="hljs-string">"keydown"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
          <span class="hljs-keyword">var</span> ctrl = e.ctrlKey || <span class="hljs-literal">false</span>;
          <span class="hljs-keyword">if</span> (ctrl) self.wheelprevented = <span class="hljs-literal">true</span>;
        });
        self.bind(_doc, <span class="hljs-string">"keyup"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
          <span class="hljs-keyword">var</span> ctrl = e.ctrlKey || <span class="hljs-literal">false</span>;
          <span class="hljs-keyword">if</span> (!ctrl) self.wheelprevented = <span class="hljs-literal">false</span>;
        });
        self.bind(_win, <span class="hljs-string">"blur"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
          self.wheelprevented = <span class="hljs-literal">false</span>;
        });

        self.bind(_win, <span class="hljs-string">'resize'</span>, self.onscreenresize);
        self.bind(_win, <span class="hljs-string">'orientationchange'</span>, self.onscreenresize);

        self.bind(_win, <span class="hljs-string">"load"</span>, self.lazyResize);

        <span class="hljs-keyword">if</span> (cap.ischrome &amp;&amp; !self.ispage &amp;&amp; !self.haswrapper) { <span class="hljs-comment">//chrome void scrollbar bug - it persists in version 26</span>
          <span class="hljs-keyword">var</span> tmp = self.win.attr(<span class="hljs-string">"style"</span>);
          <span class="hljs-keyword">var</span> ww = <span class="hljs-built_in">parseFloat</span>(self.win.css(<span class="hljs-string">"width"</span>)) + <span class="hljs-number">1</span>;
          self.win.css(<span class="hljs-string">'width'</span>, ww);
          self.synched(<span class="hljs-string">"chromefix"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            self.win.attr(<span class="hljs-string">"style"</span>, tmp);
          });
        }


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<p>Trying a cross-browser implementation - good luck!</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
        self.onAttributeChange = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
          self.lazyResize(self.isieold ? <span class="hljs-number">250</span> : <span class="hljs-number">30</span>);
        };

        <span class="hljs-keyword">if</span> (opt.enableobserver) {

          <span class="hljs-keyword">if</span> ((!self.isie11) &amp;&amp; (ClsMutationObserver !== <span class="hljs-literal">false</span>)) {  <span class="hljs-comment">// IE11 crashes  #568</span>
            self.observerbody = <span class="hljs-keyword">new</span> ClsMutationObserver(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">mutations</span>) </span>{
              mutations.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">mut</span>) </span>{
                <span class="hljs-keyword">if</span> (mut.type == <span class="hljs-string">"attributes"</span>) {
                  <span class="hljs-keyword">return</span> ($body.hasClass(<span class="hljs-string">"modal-open"</span>) &amp;&amp; $body.hasClass(<span class="hljs-string">"modal-dialog"</span>) &amp;&amp; !$.contains($(<span class="hljs-string">'.modal-dialog'</span>)[<span class="hljs-number">0</span>], self.doc[<span class="hljs-number">0</span>])) ? self.hide() : self.show();  <span class="hljs-comment">// Support for Bootstrap modal; Added check if the nice scroll element is inside a modal</span>
                }
              });
              <span class="hljs-keyword">if</span> (self.me.clientWidth != self.page.width || self.me.clientHeight != self.page.height) <span class="hljs-keyword">return</span> self.lazyResize(<span class="hljs-number">30</span>);
            });
            self.observerbody.observe(_doc.body, {
              <span class="hljs-attr">childList</span>: <span class="hljs-literal">true</span>,
              <span class="hljs-attr">subtree</span>: <span class="hljs-literal">true</span>,
              <span class="hljs-attr">characterData</span>: <span class="hljs-literal">false</span>,
              <span class="hljs-attr">attributes</span>: <span class="hljs-literal">true</span>,
              <span class="hljs-attr">attributeFilter</span>: [<span class="hljs-string">'class'</span>]
            });
          }

          <span class="hljs-keyword">if</span> (!self.ispage &amp;&amp; !self.haswrapper) {

            <span class="hljs-keyword">var</span> _dom = self.win[<span class="hljs-number">0</span>];

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<p>redesigned MutationObserver for Chrome18+/Firefox14+/iOS6+ with support for: remove div, add/remove content</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">if</span> (ClsMutationObserver !== <span class="hljs-literal">false</span>) {
              self.observer = <span class="hljs-keyword">new</span> ClsMutationObserver(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">mutations</span>) </span>{
                mutations.forEach(self.onAttributeChange);
              });
              self.observer.observe(_dom, {
                <span class="hljs-attr">childList</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">characterData</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">attributes</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">subtree</span>: <span class="hljs-literal">false</span>
              });
              self.observerremover = <span class="hljs-keyword">new</span> ClsMutationObserver(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">mutations</span>) </span>{
                mutations.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">mo</span>) </span>{
                  <span class="hljs-keyword">if</span> (mo.removedNodes.length &gt; <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> dd <span class="hljs-keyword">in</span> mo.removedNodes) {
                      <span class="hljs-keyword">if</span> (!!self &amp;&amp; (mo.removedNodes[dd] === _dom)) <span class="hljs-keyword">return</span> self.remove();
                    }
                  }
                });
              });
              self.observerremover.observe(_dom.parentNode, {
                <span class="hljs-attr">childList</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">characterData</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">attributes</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">subtree</span>: <span class="hljs-literal">false</span>
              });
            } <span class="hljs-keyword">else</span> {
              self.bind(_dom, (cap.isie &amp;&amp; !cap.isie9) ? <span class="hljs-string">"propertychange"</span> : <span class="hljs-string">"DOMAttrModified"</span>, self.onAttributeChange);
              <span class="hljs-keyword">if</span> (cap.isie9) _dom.attachEvent(<span class="hljs-string">"onpropertychange"</span>, self.onAttributeChange); <span class="hljs-comment">//IE9 DOMAttrModified bug</span>
              self.bind(_dom, <span class="hljs-string">"DOMNodeRemoved"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
                <span class="hljs-keyword">if</span> (e.target === _dom) self.remove();
              });
            }
          }

        }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
        <span class="hljs-keyword">if</span> (!self.ispage &amp;&amp; opt.boxzoom) self.bind(_win, <span class="hljs-string">"resize"</span>, self.resizeZoom);
        <span class="hljs-keyword">if</span> (self.istextarea) {
          self.bind(self.win, <span class="hljs-string">"keydown"</span>, self.lazyResize);
          self.bind(self.win, <span class="hljs-string">"mouseup"</span>, self.lazyResize);
        }

        self.lazyResize(<span class="hljs-number">30</span>);

      }

      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.doc[<span class="hljs-number">0</span>].nodeName == <span class="hljs-string">'IFRAME'</span>) {
        <span class="hljs-keyword">var</span> oniframeload = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
          self.iframexd = <span class="hljs-literal">false</span>;
          <span class="hljs-keyword">var</span> doc;
          <span class="hljs-keyword">try</span> {
            doc = <span class="hljs-string">'contentDocument'</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span> ? <span class="hljs-keyword">this</span>.contentDocument : <span class="hljs-keyword">this</span>.contentWindow._doc;
            <span class="hljs-keyword">var</span> a = doc.domain;
          } <span class="hljs-keyword">catch</span> (e) {
            self.iframexd = <span class="hljs-literal">true</span>;
            doc = <span class="hljs-literal">false</span>;
          }

          <span class="hljs-keyword">if</span> (self.iframexd) {
            <span class="hljs-keyword">if</span> (<span class="hljs-string">"console"</span> <span class="hljs-keyword">in</span> _win) <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'NiceScroll error: policy restriced iframe'</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">//cross-domain - I can't manage this        </span>
          }

          self.forcescreen = <span class="hljs-literal">true</span>;

          <span class="hljs-keyword">if</span> (self.isiframe) {
            self.iframe = {
              <span class="hljs-string">"doc"</span>: $(doc),
              <span class="hljs-string">"html"</span>: self.doc.contents().find(<span class="hljs-string">'html'</span>)[<span class="hljs-number">0</span>],
              <span class="hljs-string">"body"</span>: self.doc.contents().find(<span class="hljs-string">'body'</span>)[<span class="hljs-number">0</span>]
            };
            self.getContentSize = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
              <span class="hljs-keyword">return</span> {
                <span class="hljs-attr">w</span>: <span class="hljs-built_in">Math</span>.max(self.iframe.html.scrollWidth, self.iframe.body.scrollWidth),
                <span class="hljs-attr">h</span>: <span class="hljs-built_in">Math</span>.max(self.iframe.html.scrollHeight, self.iframe.body.scrollHeight)
              };
            };
            self.docscroll = $(self.iframe.body);
          }

          <span class="hljs-keyword">if</span> (!cap.isios &amp;&amp; opt.iframeautoresize &amp;&amp; !self.isiframe) {
            self.win.scrollTop(<span class="hljs-number">0</span>); <span class="hljs-comment">// reset position</span>
            self.doc.height(<span class="hljs-string">""</span>); <span class="hljs-comment">//reset height to fix browser bug</span>
            <span class="hljs-keyword">var</span> hh = <span class="hljs-built_in">Math</span>.max(doc.getElementsByTagName(<span class="hljs-string">'html'</span>)[<span class="hljs-number">0</span>].scrollHeight, doc.body.scrollHeight);
            self.doc.height(hh);
          }
          self.lazyResize(<span class="hljs-number">30</span>);

          self.css($(self.iframe.body), _scrollyhidden);

          <span class="hljs-keyword">if</span> (cap.isios &amp;&amp; self.haswrapper) {
            self.css($(doc.body), {
              <span class="hljs-string">'-webkit-transform'</span>: <span class="hljs-string">'translate3d(0,0,0)'</span>
            }); <span class="hljs-comment">// avoid iFrame content clipping - thanks to http://blog.derraab.com/2012/04/02/avoid-iframe-content-clipping-with-css-transform-on-ios/</span>
          }

          <span class="hljs-keyword">if</span> (<span class="hljs-string">'contentWindow'</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>) {
            self.bind(<span class="hljs-keyword">this</span>.contentWindow, <span class="hljs-string">"scroll"</span>, self.onscroll); <span class="hljs-comment">//IE8 &amp; minor</span>
          } <span class="hljs-keyword">else</span> {
            self.bind(doc, <span class="hljs-string">"scroll"</span>, self.onscroll);
          }

          <span class="hljs-keyword">if</span> (opt.enablemousewheel) {
            self.mousewheel(doc, self.onmousewheel);
          }

          <span class="hljs-keyword">if</span> (opt.enablekeyboard) self.bind(doc, (cap.isopera) ? <span class="hljs-string">"keypress"</span> : <span class="hljs-string">"keydown"</span>, self.onkeypress);

          <span class="hljs-keyword">if</span> (cap.cantouch) {
            self.bind(doc, <span class="hljs-string">"touchstart"</span>, self.ontouchstart);
            self.bind(doc, <span class="hljs-string">"touchmove"</span>, self.ontouchmove);
          }
          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (opt.emulatetouch) {
            self.bind(doc, <span class="hljs-string">"mousedown"</span>, self.ontouchstart);
            self.bind(doc, <span class="hljs-string">"mousemove"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
              <span class="hljs-keyword">return</span> self.ontouchmove(e, <span class="hljs-literal">true</span>);
            });
            <span class="hljs-keyword">if</span> (opt.grabcursorenabled &amp;&amp; cap.cursorgrabvalue) self.css($(doc.body), {
              <span class="hljs-string">'cursor'</span>: cap.cursorgrabvalue
            });
          }

          self.bind(doc, <span class="hljs-string">"mouseup"</span>, self.ontouchend);

          <span class="hljs-keyword">if</span> (self.zoom) {
            <span class="hljs-keyword">if</span> (opt.dblclickzoom) self.bind(doc, <span class="hljs-string">'dblclick'</span>, self.doZoom);
            <span class="hljs-keyword">if</span> (self.ongesturezoom) self.bind(doc, <span class="hljs-string">"gestureend"</span>, self.ongesturezoom);
          }
        };

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.doc[<span class="hljs-number">0</span>].readyState &amp;&amp; <span class="hljs-keyword">this</span>.doc[<span class="hljs-number">0</span>].readyState === <span class="hljs-string">"complete"</span>) {
          setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            oniframeload.call(self.doc[<span class="hljs-number">0</span>], <span class="hljs-literal">false</span>);
          }, <span class="hljs-number">500</span>);
        }
        self.bind(<span class="hljs-keyword">this</span>.doc, <span class="hljs-string">"load"</span>, oniframeload);

      }

    };

    <span class="hljs-keyword">this</span>.showCursor = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">py, px</span>) </span>{
      <span class="hljs-keyword">if</span> (self.cursortimeout) {
        clearTimeout(self.cursortimeout);
        self.cursortimeout = <span class="hljs-number">0</span>;
      }
      <span class="hljs-keyword">if</span> (!self.rail) <span class="hljs-keyword">return</span>;
      <span class="hljs-keyword">if</span> (self.autohidedom) {
        self.autohidedom.stop().css({
          <span class="hljs-attr">opacity</span>: opt.cursoropacitymax
        });
        self.cursoractive = <span class="hljs-literal">true</span>;
      }

      <span class="hljs-keyword">if</span> (!self.rail.drag || self.rail.drag.pt != <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">if</span> (py !== <span class="hljs-literal">undefined</span> &amp;&amp; py !== <span class="hljs-literal">false</span>) {
          self.scroll.y = (py / self.scrollratio.y) | <span class="hljs-number">0</span>;
        }
        <span class="hljs-keyword">if</span> (px !== <span class="hljs-literal">undefined</span>) {
          self.scroll.x = (px / self.scrollratio.x) | <span class="hljs-number">0</span>;
        }
      }

      self.cursor.css({
        <span class="hljs-attr">height</span>: self.cursorheight,
        <span class="hljs-attr">top</span>: self.scroll.y
      });
      <span class="hljs-keyword">if</span> (self.cursorh) {
        <span class="hljs-keyword">var</span> lx = (self.hasreversehr) ? self.scrollvaluemaxw - self.scroll.x : self.scroll.x;
        self.cursorh.css({
          <span class="hljs-attr">width</span>: self.cursorwidth,
          <span class="hljs-attr">left</span>: (!self.rail.align &amp;&amp; self.rail.visibility) ? lx + self.rail.width : lx
        });
        self.cursoractive = <span class="hljs-literal">true</span>;
      }

      <span class="hljs-keyword">if</span> (self.zoom) self.zoom.stop().css({
        <span class="hljs-attr">opacity</span>: opt.cursoropacitymax
      });
    };

    <span class="hljs-keyword">this</span>.hideCursor = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">tm</span>) </span>{
      <span class="hljs-keyword">if</span> (self.cursortimeout) <span class="hljs-keyword">return</span>;
      <span class="hljs-keyword">if</span> (!self.rail) <span class="hljs-keyword">return</span>;
      <span class="hljs-keyword">if</span> (!self.autohidedom) <span class="hljs-keyword">return</span>;

      <span class="hljs-keyword">if</span> (self.hasmousefocus &amp;&amp; opt.autohidemode === <span class="hljs-string">"leave"</span>) <span class="hljs-keyword">return</span>;
      self.cursortimeout = setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (!self.rail.active || !self.showonmouseevent) {
          self.autohidedom.stop().animate({
            <span class="hljs-attr">opacity</span>: opt.cursoropacitymin
          });
          <span class="hljs-keyword">if</span> (self.zoom) self.zoom.stop().animate({
            <span class="hljs-attr">opacity</span>: opt.cursoropacitymin
          });
          self.cursoractive = <span class="hljs-literal">false</span>;
        }
        self.cursortimeout = <span class="hljs-number">0</span>;
      }, tm || opt.hidecursordelay);
    };

    <span class="hljs-keyword">this</span>.noticeCursor = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">tm, py, px</span>) </span>{
      self.showCursor(py, px);
      <span class="hljs-keyword">if</span> (!self.rail.active) self.hideCursor(tm);
    };

    <span class="hljs-keyword">this</span>.getContentSize =
      (self.ispage) ?
        <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
          <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">w</span>: <span class="hljs-built_in">Math</span>.max(_doc.body.scrollWidth, _doc.documentElement.scrollWidth),
            <span class="hljs-attr">h</span>: <span class="hljs-built_in">Math</span>.max(_doc.body.scrollHeight, _doc.documentElement.scrollHeight)
          };
        } : (self.haswrapper) ?
          <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> {
              <span class="hljs-attr">w</span>: self.doc[<span class="hljs-number">0</span>].offsetWidth,
              <span class="hljs-attr">h</span>: self.doc[<span class="hljs-number">0</span>].offsetHeight
            };
          } : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> {
              <span class="hljs-attr">w</span>: self.docscroll[<span class="hljs-number">0</span>].scrollWidth,
              <span class="hljs-attr">h</span>: self.docscroll[<span class="hljs-number">0</span>].scrollHeight
            };
          };

    <span class="hljs-keyword">this</span>.onResize = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e, page</span>) </span>{

      <span class="hljs-keyword">if</span> (!self || !self.win) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

      <span class="hljs-keyword">var</span> premaxh = self.page.maxh,
          premaxw = self.page.maxw,
          previewh = self.view.h,
          previeww = self.view.w;

      self.view = {
        <span class="hljs-attr">w</span>: (self.ispage) ? self.win.width() : self.win[<span class="hljs-number">0</span>].clientWidth,
        <span class="hljs-attr">h</span>: (self.ispage) ? self.win.height() : self.win[<span class="hljs-number">0</span>].clientHeight
      };

      self.page = (page) ? page : self.getContentSize();

      self.page.maxh = <span class="hljs-built_in">Math</span>.max(<span class="hljs-number">0</span>, self.page.h - self.view.h);
      self.page.maxw = <span class="hljs-built_in">Math</span>.max(<span class="hljs-number">0</span>, self.page.w - self.view.w);

      <span class="hljs-keyword">if</span> ((self.page.maxh == premaxh) &amp;&amp; (self.page.maxw == premaxw) &amp;&amp; (self.view.w == previeww) &amp;&amp; (self.view.h == previewh)) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<p>test position</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> (!self.ispage) {
          <span class="hljs-keyword">var</span> pos = self.win.offset();
          <span class="hljs-keyword">if</span> (self.lastposition) {
            <span class="hljs-keyword">var</span> lst = self.lastposition;
            <span class="hljs-keyword">if</span> ((lst.top == pos.top) &amp;&amp; (lst.left == pos.left)) <span class="hljs-keyword">return</span> self; <span class="hljs-comment">//nothing to do            </span>
          }
          self.lastposition = pos;
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> self; <span class="hljs-comment">//nothing to do</span>
        }
      }

      <span class="hljs-keyword">if</span> (self.page.maxh === <span class="hljs-number">0</span>) {
        self.hideRail();
        self.scrollvaluemax = <span class="hljs-number">0</span>;
        self.scroll.y = <span class="hljs-number">0</span>;
        self.scrollratio.y = <span class="hljs-number">0</span>;
        self.cursorheight = <span class="hljs-number">0</span>;
        self.setScrollTop(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">if</span> (self.rail) self.rail.scrollable = <span class="hljs-literal">false</span>;
      } <span class="hljs-keyword">else</span> {
        self.page.maxh -= (opt.railpadding.top + opt.railpadding.bottom);
        self.rail.scrollable = <span class="hljs-literal">true</span>;
      }

      <span class="hljs-keyword">if</span> (self.page.maxw === <span class="hljs-number">0</span>) {
        self.hideRailHr();
        self.scrollvaluemaxw = <span class="hljs-number">0</span>;
        self.scroll.x = <span class="hljs-number">0</span>;
        self.scrollratio.x = <span class="hljs-number">0</span>;
        self.cursorwidth = <span class="hljs-number">0</span>;
        self.setScrollLeft(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">if</span> (self.railh) {
          self.railh.scrollable = <span class="hljs-literal">false</span>;
        }
      } <span class="hljs-keyword">else</span> {
        self.page.maxw -= (opt.railpadding.left + opt.railpadding.right);
        <span class="hljs-keyword">if</span> (self.railh) self.railh.scrollable = (opt.horizrailenabled);
      }

      self.railslocked = (self.locked) || ((self.page.maxh === <span class="hljs-number">0</span>) &amp;&amp; (self.page.maxw === <span class="hljs-number">0</span>));
      <span class="hljs-keyword">if</span> (self.railslocked) {
        <span class="hljs-keyword">if</span> (!self.ispage) self.updateScrollBar(self.view);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      }

      <span class="hljs-keyword">if</span> (!self.hidden) {
        <span class="hljs-keyword">if</span> (!self.rail.visibility) self.showRail();
        <span class="hljs-keyword">if</span> (self.railh &amp;&amp; !self.railh.visibility) self.showRailHr();
      }

      <span class="hljs-keyword">if</span> (self.istextarea &amp;&amp; self.win.css(<span class="hljs-string">'resize'</span>) &amp;&amp; self.win.css(<span class="hljs-string">'resize'</span>) != <span class="hljs-string">'none'</span>) self.view.h -= <span class="hljs-number">20</span>;

      self.cursorheight = <span class="hljs-built_in">Math</span>.min(self.view.h, <span class="hljs-built_in">Math</span>.round(self.view.h * (self.view.h / self.page.h)));
      self.cursorheight = (opt.cursorfixedheight) ? opt.cursorfixedheight : <span class="hljs-built_in">Math</span>.max(opt.cursorminheight, self.cursorheight);

      self.cursorwidth = <span class="hljs-built_in">Math</span>.min(self.view.w, <span class="hljs-built_in">Math</span>.round(self.view.w * (self.view.w / self.page.w)));
      self.cursorwidth = (opt.cursorfixedheight) ? opt.cursorfixedheight : <span class="hljs-built_in">Math</span>.max(opt.cursorminheight, self.cursorwidth);

      self.scrollvaluemax = self.view.h - self.cursorheight - (opt.railpadding.top + opt.railpadding.bottom);
      <span class="hljs-keyword">if</span> (!self.hasborderbox) self.scrollvaluemax -= self.cursor[<span class="hljs-number">0</span>].offsetHeight - self.cursor[<span class="hljs-number">0</span>].clientHeight;

      <span class="hljs-keyword">if</span> (self.railh) {
        self.railh.width = (self.page.maxh &gt; <span class="hljs-number">0</span>) ? (self.view.w - self.rail.width) : self.view.w;
        self.scrollvaluemaxw = self.railh.width - self.cursorwidth - (opt.railpadding.left + opt.railpadding.right);
      }

      <span class="hljs-keyword">if</span> (!self.ispage) self.updateScrollBar(self.view);

      self.scrollratio = {
        <span class="hljs-attr">x</span>: (self.page.maxw / self.scrollvaluemaxw),
        <span class="hljs-attr">y</span>: (self.page.maxh / self.scrollvaluemax)
      };

      <span class="hljs-keyword">var</span> sy = self.getScrollTop();
      <span class="hljs-keyword">if</span> (sy &gt; self.page.maxh) {
        self.doScrollTop(self.page.maxh);
      } <span class="hljs-keyword">else</span> {
        self.scroll.y = (self.getScrollTop() / self.scrollratio.y) | <span class="hljs-number">0</span>;
        self.scroll.x = (self.getScrollLeft() / self.scrollratio.x) | <span class="hljs-number">0</span>;
        <span class="hljs-keyword">if</span> (self.cursoractive) self.noticeCursor();
      }

      <span class="hljs-keyword">if</span> (self.scroll.y &amp;&amp; (self.getScrollTop() === <span class="hljs-number">0</span>)) self.doScrollTo((self.scroll.y * self.scrollratio.y)|<span class="hljs-number">0</span>);

      <span class="hljs-keyword">return</span> self;
    };

    <span class="hljs-keyword">this</span>.resize = self.onResize;

    <span class="hljs-keyword">var</span> hlazyresize = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">this</span>.onscreenresize = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
      clearTimeout(hlazyresize);

      <span class="hljs-keyword">var</span> hiderails = (!self.ispage &amp;&amp; !self.haswrapper);
      <span class="hljs-keyword">if</span> (hiderails) self.hideRails();

      hlazyresize = setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (self) {
          <span class="hljs-keyword">if</span> (hiderails) self.showRails();
          self.resize();
        }
        hlazyresize=<span class="hljs-number">0</span>;
      }, <span class="hljs-number">120</span>);
    };

    <span class="hljs-keyword">this</span>.lazyResize = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">tm</span>) </span>{ <span class="hljs-comment">// event debounce</span>

      clearTimeout(hlazyresize);

      tm = <span class="hljs-built_in">isNaN</span>(tm) ? <span class="hljs-number">240</span> : tm;

      hlazyresize = setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        self &amp;&amp; self.resize();
        hlazyresize=<span class="hljs-number">0</span>;
      }, tm);

      <span class="hljs-keyword">return</span> self;

    };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<p>derived by MDN https://developer.mozilla.org/en-US/docs/DOM/Mozilla_event_reference/wheel</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_modernWheelEvent</span>(<span class="hljs-params">dom, name, fn, bubble</span>) </span>{
      self._bind(dom, name, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
        e = e || _win.event;
        <span class="hljs-keyword">var</span> event = {
          <span class="hljs-attr">original</span>: e,
          <span class="hljs-attr">target</span>: e.target || e.srcElement,
          <span class="hljs-attr">type</span>: <span class="hljs-string">"wheel"</span>,
          <span class="hljs-attr">deltaMode</span>: e.type == <span class="hljs-string">"MozMousePixelScroll"</span> ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>,
          <span class="hljs-attr">deltaX</span>: <span class="hljs-number">0</span>,
          <span class="hljs-attr">deltaZ</span>: <span class="hljs-number">0</span>,
          <span class="hljs-attr">preventDefault</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            e.preventDefault ? e.preventDefault() : e.returnValue = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
          },
          <span class="hljs-attr">stopImmediatePropagation</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            (e.stopImmediatePropagation) ? e.stopImmediatePropagation() : e.cancelBubble = <span class="hljs-literal">true</span>;
          }
        };

        <span class="hljs-keyword">if</span> (name == <span class="hljs-string">"mousewheel"</span>) {
          e.wheelDeltaX &amp;&amp; (event.deltaX = <span class="hljs-number">-1</span> / <span class="hljs-number">40</span> * e.wheelDeltaX);
          e.wheelDeltaY &amp;&amp; (event.deltaY = <span class="hljs-number">-1</span> / <span class="hljs-number">40</span> * e.wheelDeltaY);
          !event.deltaY &amp;&amp; !event.deltaX &amp;&amp; (event.deltaY = <span class="hljs-number">-1</span> / <span class="hljs-number">40</span> * e.wheelDelta);
        } <span class="hljs-keyword">else</span> {
          event.deltaY = e.detail;
        }

        <span class="hljs-keyword">return</span> fn.call(dom, event);
      }, bubble);
    }



    <span class="hljs-keyword">this</span>.jqbind = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">dom, name, fn</span>) </span>{ <span class="hljs-comment">// use jquery bind for non-native events (mouseenter/mouseleave)</span>
      self.events.push({
        <span class="hljs-attr">e</span>: dom,
        <span class="hljs-attr">n</span>: name,
        <span class="hljs-attr">f</span>: fn,
        <span class="hljs-attr">q</span>: <span class="hljs-literal">true</span>
      });
      $(dom).on(name, fn);
    };

    <span class="hljs-keyword">this</span>.mousewheel = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">dom, fn, bubble</span>) </span>{ <span class="hljs-comment">// bind mousewheel</span>
      <span class="hljs-keyword">var</span> el = (<span class="hljs-string">"jquery"</span> <span class="hljs-keyword">in</span> dom) ? dom[<span class="hljs-number">0</span>] : dom;
      <span class="hljs-keyword">if</span> (<span class="hljs-string">"onwheel"</span> <span class="hljs-keyword">in</span> _doc.createElement(<span class="hljs-string">"div"</span>)) { <span class="hljs-comment">// Modern browsers support "wheel"</span>
        self._bind(el, <span class="hljs-string">"wheel"</span>, fn, bubble || <span class="hljs-literal">false</span>);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">var</span> wname = (_doc.onmousewheel !== <span class="hljs-literal">undefined</span>) ? <span class="hljs-string">"mousewheel"</span> : <span class="hljs-string">"DOMMouseScroll"</span>; <span class="hljs-comment">// older Webkit+IE support or older Firefox          </span>
        _modernWheelEvent(el, wname, fn, bubble || <span class="hljs-literal">false</span>);
        <span class="hljs-keyword">if</span> (wname == <span class="hljs-string">"DOMMouseScroll"</span>) _modernWheelEvent(el, <span class="hljs-string">"MozMousePixelScroll"</span>, fn, bubble || <span class="hljs-literal">false</span>); <span class="hljs-comment">// Firefox legacy</span>
      }
    };

    <span class="hljs-keyword">var</span> passiveSupported = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">if</span> (cap.haseventlistener) {  <span class="hljs-comment">// W3C standard event model</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<p>thanks to https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">try</span> { <span class="hljs-keyword">var</span> options = <span class="hljs-built_in">Object</span>.defineProperty({}, <span class="hljs-string">"passive"</span>, { <span class="hljs-attr">get</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ passiveSupported = !<span class="hljs-number">0</span>; } }); _win.addEventListener(<span class="hljs-string">"test"</span>, <span class="hljs-literal">null</span>, options); } <span class="hljs-keyword">catch</span> (err) { }

      <span class="hljs-keyword">this</span>.stopPropagation = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
        <span class="hljs-keyword">if</span> (!e) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        e = (e.original) ? e.original : e;
        e.stopPropagation();
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      };

      <span class="hljs-keyword">this</span>.cancelEvent = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        <span class="hljs-keyword">if</span> (e.cancelable) e.preventDefault();
        e.stopImmediatePropagation();
        <span class="hljs-keyword">if</span> (e.preventManipulation) e.preventManipulation();  <span class="hljs-comment">// IE10+</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      };      

    } <span class="hljs-keyword">else</span> {

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31"></a>
</div>
<p>inspired from https://gist.github.com/jonathantneal/2415137</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
      Event.prototype.preventDefault = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">this</span>.returnValue = <span class="hljs-literal">false</span>;
      };

      Event.prototype.stopPropagation = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">this</span>.cancelBubble = <span class="hljs-literal">true</span>;
      };

      _win.constructor.prototype.addEventListener = _doc.constructor.prototype.addEventListener = Element.prototype.addEventListener = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">type, listener, useCapture</span>) </span>{
        <span class="hljs-keyword">this</span>.attachEvent(<span class="hljs-string">"on"</span> + type, listener);
      };
      _win.constructor.prototype.removeEventListener = _doc.constructor.prototype.removeEventListener = Element.prototype.removeEventListener = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">type, listener, useCapture</span>) </span>{
        <span class="hljs-keyword">this</span>.detachEvent(<span class="hljs-string">"on"</span> + type, listener);
      };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32"></a>
</div>
<p>Thanks to http://www.switchonthecode.com !!</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">this</span>.cancelEvent = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
        e = e || _win.event;
        <span class="hljs-keyword">if</span> (e) {          
          e.cancelBubble = <span class="hljs-literal">true</span>;
          e.cancel = <span class="hljs-literal">true</span>;
          e.returnValue = <span class="hljs-literal">false</span>;
        }  
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      };

      <span class="hljs-keyword">this</span>.stopPropagation = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
        e = e || _win.event;
        <span class="hljs-keyword">if</span> (e) e.cancelBubble = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      };

    }

    <span class="hljs-keyword">this</span>.delegate = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">dom, name, fn, bubble, active</span>) </span>{

      <span class="hljs-keyword">var</span> de = delegatevents[name] || <span class="hljs-literal">false</span>;

      <span class="hljs-keyword">if</span> (!de) {

        de = {
          <span class="hljs-attr">a</span>: [],
          <span class="hljs-attr">l</span>: [],
          <span class="hljs-attr">f</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
            <span class="hljs-keyword">var</span> lst = de.l, l = lst.length - <span class="hljs-number">1</span>;
            <span class="hljs-keyword">var</span> r = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> a = l; a &gt;= <span class="hljs-number">0</span>; a--) {
              r = lst[a].call(e.target, e);
              <span class="hljs-keyword">if</span> (r === <span class="hljs-literal">false</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
            <span class="hljs-keyword">return</span> r;
          }
        };

        self.bind(dom, name, de.f, bubble, active);

        delegatevents[name] = de;

      }

      <span class="hljs-keyword">if</span> (self.ispage) {
        de.a = [self.id].concat(de.a);
        de.l = [fn].concat(de.l);
      } <span class="hljs-keyword">else</span> {
        de.a.push(self.id);
        de.l.push(fn);        
      }

    };

    <span class="hljs-keyword">this</span>.undelegate = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">dom, name, fn, bubble, active</span>) </span>{
      <span class="hljs-keyword">var</span> de = delegatevents[name]||<span class="hljs-literal">false</span>;
      <span class="hljs-keyword">if</span> (de&amp;&amp;de.l) {  <span class="hljs-comment">// quick fix #683</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> a=<span class="hljs-number">0</span>,l=de.l.length;a&lt;l;a++) {
          <span class="hljs-keyword">if</span> (de.a[a] === self.id) {
            de.a.splice(a);
            de.l.splice(a);
            <span class="hljs-keyword">if</span> (de.a.length===<span class="hljs-number">0</span>) {
              self._unbind(dom,name,de.l.f);
              delegatevents[name] = <span class="hljs-literal">null</span>;
            }
          }
        }
      }
    };

    <span class="hljs-keyword">this</span>.bind = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">dom, name, fn, bubble, active</span>) </span>{
      <span class="hljs-keyword">var</span> el = (<span class="hljs-string">"jquery"</span> <span class="hljs-keyword">in</span> dom) ? dom[<span class="hljs-number">0</span>] : dom;
      self._bind(el, name, fn, bubble || <span class="hljs-literal">false</span>, active || <span class="hljs-literal">false</span>);
    };

    <span class="hljs-keyword">this</span>._bind = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">el, name, fn, bubble, active</span>) </span>{ <span class="hljs-comment">// primitive bind</span>

      self.events.push({
        <span class="hljs-attr">e</span>: el,
        <span class="hljs-attr">n</span>: name,
        <span class="hljs-attr">f</span>: fn,
        <span class="hljs-attr">b</span>: bubble,
        <span class="hljs-attr">q</span>: <span class="hljs-literal">false</span>
      });

      (passiveSupported &amp;&amp; active) ? el.addEventListener(name, fn, { <span class="hljs-attr">passive</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">capture</span>: bubble }) : el.addEventListener(name, fn, bubble || <span class="hljs-literal">false</span>);
    };

    <span class="hljs-keyword">this</span>._unbind = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">el, name, fn, bub</span>) </span>{ <span class="hljs-comment">// primitive unbind</span>
      <span class="hljs-keyword">if</span> (delegatevents[name]) self.undelegate(el, name, fn, bub);
      <span class="hljs-keyword">else</span> el.removeEventListener(name, fn, bub);
    };

    <span class="hljs-keyword">this</span>.unbindAll = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> a = <span class="hljs-number">0</span>; a &lt; self.events.length; a++) {
        <span class="hljs-keyword">var</span> r = self.events[a];
        (r.q) ? r.e.unbind(r.n, r.f) : self._unbind(r.e, r.n, r.f, r.b);
      }
    };

    <span class="hljs-keyword">this</span>.showRails = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> self.showRail().showRailHr();
    };

    <span class="hljs-keyword">this</span>.showRail = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">if</span> ((self.page.maxh !== <span class="hljs-number">0</span>) &amp;&amp; (self.ispage || self.win.css(<span class="hljs-string">'display'</span>) != <span class="hljs-string">'none'</span>)) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33"></a>
</div>
<p>self.visibility = true;</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        self.rail.visibility = <span class="hljs-literal">true</span>;
        self.rail.css(<span class="hljs-string">'display'</span>, <span class="hljs-string">'block'</span>);
      }
      <span class="hljs-keyword">return</span> self;
    };

    <span class="hljs-keyword">this</span>.showRailHr = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">if</span> (self.railh) {
        <span class="hljs-keyword">if</span> ((self.page.maxw !== <span class="hljs-number">0</span>) &amp;&amp; (self.ispage || self.win.css(<span class="hljs-string">'display'</span>) != <span class="hljs-string">'none'</span>)) {
          self.railh.visibility = <span class="hljs-literal">true</span>;
          self.railh.css(<span class="hljs-string">'display'</span>, <span class="hljs-string">'block'</span>);
        }
      }
      <span class="hljs-keyword">return</span> self;
    };

    <span class="hljs-keyword">this</span>.hideRails = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> self.hideRail().hideRailHr();
    };

    <span class="hljs-keyword">this</span>.hideRail = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34"></a>
</div>
<p>self.visibility = false;</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      self.rail.visibility = <span class="hljs-literal">false</span>;
      self.rail.css(<span class="hljs-string">'display'</span>, <span class="hljs-string">'none'</span>);
      <span class="hljs-keyword">return</span> self;
    };

    <span class="hljs-keyword">this</span>.hideRailHr = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">if</span> (self.railh) {
        self.railh.visibility = <span class="hljs-literal">false</span>;
        self.railh.css(<span class="hljs-string">'display'</span>, <span class="hljs-string">'none'</span>);
      }
      <span class="hljs-keyword">return</span> self;
    };

    <span class="hljs-keyword">this</span>.show = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      self.hidden = <span class="hljs-literal">false</span>;
      self.railslocked = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">return</span> self.showRails();
    };

    <span class="hljs-keyword">this</span>.hide = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      self.hidden = <span class="hljs-literal">true</span>;
      self.railslocked = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">return</span> self.hideRails();
    };

    <span class="hljs-keyword">this</span>.toggle = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> (self.hidden) ? self.show() : self.hide();
    };

    <span class="hljs-keyword">this</span>.remove = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      self.stop();
      <span class="hljs-keyword">if</span> (self.cursortimeout) clearTimeout(self.cursortimeout);
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> n <span class="hljs-keyword">in</span> self.delaylist) <span class="hljs-keyword">if</span> (self.delaylist[n]) clearAnimationFrame(self.delaylist[n].h);
      self.doZoomOut();
      self.unbindAll();

      <span class="hljs-keyword">if</span> (cap.isie9) self.win[<span class="hljs-number">0</span>].detachEvent(<span class="hljs-string">"onpropertychange"</span>, self.onAttributeChange); <span class="hljs-comment">//IE9 DOMAttrModified bug</span>

      <span class="hljs-keyword">if</span> (self.observer !== <span class="hljs-literal">false</span>) self.observer.disconnect();
      <span class="hljs-keyword">if</span> (self.observerremover !== <span class="hljs-literal">false</span>) self.observerremover.disconnect();
      <span class="hljs-keyword">if</span> (self.observerbody !== <span class="hljs-literal">false</span>) self.observerbody.disconnect();

      self.events = <span class="hljs-literal">null</span>;

      <span class="hljs-keyword">if</span> (self.cursor) {
        self.cursor.remove();
      }
      <span class="hljs-keyword">if</span> (self.cursorh) {
        self.cursorh.remove();
      }
      <span class="hljs-keyword">if</span> (self.rail) {
        self.rail.remove();
      }
      <span class="hljs-keyword">if</span> (self.railh) {
        self.railh.remove();
      }
      <span class="hljs-keyword">if</span> (self.zoom) {
        self.zoom.remove();
      }
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> a = <span class="hljs-number">0</span>; a &lt; self.saved.css.length; a++) {
        <span class="hljs-keyword">var</span> d = self.saved.css[a];
        d[<span class="hljs-number">0</span>].css(d[<span class="hljs-number">1</span>], (d[<span class="hljs-number">2</span>] === <span class="hljs-literal">undefined</span>) ? <span class="hljs-string">''</span> : d[<span class="hljs-number">2</span>]);
      }
      self.saved = <span class="hljs-literal">false</span>;
      self.me.data(<span class="hljs-string">'__nicescroll'</span>, <span class="hljs-string">''</span>); <span class="hljs-comment">//erase all traces</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35"></a>
</div>
<p>memory leak fixed by GianlucaGuarini - thanks a lot!
remove the current nicescroll from the $.nicescroll array &amp; normalize array</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">var</span> lst = $.nicescroll;
      lst.each(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">i</span>) </span>{
        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.id === self.id) {
          <span class="hljs-keyword">delete</span> lst[i];
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> b = ++i; b &lt; lst.length; b++ , i++) lst[i] = lst[b];
          lst.length--;
          <span class="hljs-keyword">if</span> (lst.length) <span class="hljs-keyword">delete</span> lst[lst.length];
        }
      });

      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> self) {
        self[i] = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">delete</span> self[i];
      }

      self = <span class="hljs-literal">null</span>;

    };

    <span class="hljs-keyword">this</span>.scrollstart = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fn</span>) </span>{
      <span class="hljs-keyword">this</span>.onscrollstart = fn;
      <span class="hljs-keyword">return</span> self;
    };
    <span class="hljs-keyword">this</span>.scrollend = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fn</span>) </span>{
      <span class="hljs-keyword">this</span>.onscrollend = fn;
      <span class="hljs-keyword">return</span> self;
    };
    <span class="hljs-keyword">this</span>.scrollcancel = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fn</span>) </span>{
      <span class="hljs-keyword">this</span>.onscrollcancel = fn;
      <span class="hljs-keyword">return</span> self;
    };

    <span class="hljs-keyword">this</span>.zoomin = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fn</span>) </span>{
      <span class="hljs-keyword">this</span>.onzoomin = fn;
      <span class="hljs-keyword">return</span> self;
    };
    <span class="hljs-keyword">this</span>.zoomout = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fn</span>) </span>{
      <span class="hljs-keyword">this</span>.onzoomout = fn;
      <span class="hljs-keyword">return</span> self;
    };

    <span class="hljs-keyword">this</span>.isScrollable = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
      <span class="hljs-keyword">var</span> dom = (e.target) ? e.target : e;
      <span class="hljs-keyword">if</span> (dom.nodeName == <span class="hljs-string">'OPTION'</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">while</span> (dom &amp;&amp; (dom.nodeType == <span class="hljs-number">1</span>) &amp;&amp; (dom !== <span class="hljs-keyword">this</span>.me[<span class="hljs-number">0</span>]) &amp;&amp; !(<span class="hljs-regexp">/^BODY|HTML/</span>.test(dom.nodeName))) {
        <span class="hljs-keyword">var</span> dd = $(dom);
        <span class="hljs-keyword">var</span> ov = dd.css(<span class="hljs-string">'overflowY'</span>) || dd.css(<span class="hljs-string">'overflowX'</span>) || dd.css(<span class="hljs-string">'overflow'</span>) || <span class="hljs-string">''</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/scroll|auto/</span>.test(ov)) <span class="hljs-keyword">return</span> (dom.clientHeight != dom.scrollHeight);
        dom = (dom.parentNode) ? dom.parentNode : <span class="hljs-literal">false</span>;
      }
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    };

    <span class="hljs-keyword">this</span>.getViewport = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">me</span>) </span>{
      <span class="hljs-keyword">var</span> dom = (me &amp;&amp; me.parentNode) ? me.parentNode : <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">while</span> (dom &amp;&amp; (dom.nodeType == <span class="hljs-number">1</span>) &amp;&amp; !(<span class="hljs-regexp">/^BODY|HTML/</span>.test(dom.nodeName))) {
        <span class="hljs-keyword">var</span> dd = $(dom);
        <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/fixed|absolute/</span>.test(dd.css(<span class="hljs-string">"position"</span>))) <span class="hljs-keyword">return</span> dd;
        <span class="hljs-keyword">var</span> ov = dd.css(<span class="hljs-string">'overflowY'</span>) || dd.css(<span class="hljs-string">'overflowX'</span>) || dd.css(<span class="hljs-string">'overflow'</span>) || <span class="hljs-string">''</span>;
        <span class="hljs-keyword">if</span> ((<span class="hljs-regexp">/scroll|auto/</span>.test(ov)) &amp;&amp; (dom.clientHeight != dom.scrollHeight)) <span class="hljs-keyword">return</span> dd;
        <span class="hljs-keyword">if</span> (dd.getNiceScroll().length &gt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> dd;
        dom = (dom.parentNode) ? dom.parentNode : <span class="hljs-literal">false</span>;
      }
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    };

    <span class="hljs-keyword">this</span>.triggerScrollStart = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">cx, cy, rx, ry, ms</span>) </span>{

      <span class="hljs-keyword">if</span> (self.onscrollstart) {
        <span class="hljs-keyword">var</span> info = {
          <span class="hljs-attr">type</span>: <span class="hljs-string">"scrollstart"</span>,
          <span class="hljs-attr">current</span>: {
            <span class="hljs-attr">x</span>: cx,
            <span class="hljs-attr">y</span>: cy
          },
          <span class="hljs-attr">request</span>: {
            <span class="hljs-attr">x</span>: rx,
            <span class="hljs-attr">y</span>: ry
          },
          <span class="hljs-attr">end</span>: {
            <span class="hljs-attr">x</span>: self.newscrollx,
            <span class="hljs-attr">y</span>: self.newscrolly
          },
          <span class="hljs-attr">speed</span>: ms
        };
        self.onscrollstart.call(self, info);
      }

    };

    <span class="hljs-keyword">this</span>.triggerScrollEnd = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">if</span> (self.onscrollend) {

        <span class="hljs-keyword">var</span> px = self.getScrollLeft();
        <span class="hljs-keyword">var</span> py = self.getScrollTop();

        <span class="hljs-keyword">var</span> info = {
          <span class="hljs-attr">type</span>: <span class="hljs-string">"scrollend"</span>,
          <span class="hljs-attr">current</span>: {
            <span class="hljs-attr">x</span>: px,
            <span class="hljs-attr">y</span>: py
          },
          <span class="hljs-attr">end</span>: {
            <span class="hljs-attr">x</span>: px,
            <span class="hljs-attr">y</span>: py
          }
        };

        self.onscrollend.call(self, info);

      }

    };

    <span class="hljs-keyword">var</span> scrolldiry = <span class="hljs-number">0</span>, scrolldirx = <span class="hljs-number">0</span>, scrolltmr = <span class="hljs-number">0</span>, scrollspd = <span class="hljs-number">1</span>;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doScrollRelative</span>(<span class="hljs-params">px, py, chkscroll, iswheel</span>) </span>{

      <span class="hljs-keyword">if</span> (!self.scrollrunning) {
        self.newscrolly = self.getScrollTop();
        self.newscrollx = self.getScrollLeft();
        scrolltmr = now();
      }

      <span class="hljs-keyword">var</span> gap = (now() - scrolltmr);
      scrolltmr = now();

      <span class="hljs-keyword">if</span> (gap &gt; <span class="hljs-number">350</span>) {
        scrollspd = <span class="hljs-number">1</span>;
      } <span class="hljs-keyword">else</span> {
        scrollspd += (<span class="hljs-number">2</span> - scrollspd) / <span class="hljs-number">10</span>;
      }

      px = px * scrollspd | <span class="hljs-number">0</span>;
      py = py * scrollspd | <span class="hljs-number">0</span>;

      <span class="hljs-keyword">if</span> (px) {

        <span class="hljs-keyword">if</span> (iswheel) { <span class="hljs-comment">// mouse-only</span>
          <span class="hljs-keyword">if</span> (px &lt; <span class="hljs-number">0</span>) {  <span class="hljs-comment">// fix apple magic mouse swipe back/forward</span>
            <span class="hljs-keyword">if</span> (self.getScrollLeft() &gt;= self.page.maxw) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (self.getScrollLeft() &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
          }
        }

        <span class="hljs-keyword">var</span> dx = px &gt; <span class="hljs-number">0</span> ? <span class="hljs-number">1</span> : <span class="hljs-number">-1</span>;

        <span class="hljs-keyword">if</span> (scrolldirx !== dx) {
          <span class="hljs-keyword">if</span> (self.scrollmom) self.scrollmom.stop();
          self.newscrollx = self.getScrollLeft();
          scrolldirx = dx;
        }

        self.lastdeltax -= px;

      }

      <span class="hljs-keyword">if</span> (py) {

        <span class="hljs-keyword">var</span> chk = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
          <span class="hljs-keyword">var</span> top = self.getScrollTop();
          <span class="hljs-keyword">if</span> (py &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">if</span> (top &gt;= self.page.maxh) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (top &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
          }
        })();

        <span class="hljs-keyword">if</span> (chk) {
          <span class="hljs-keyword">if</span> (opt.nativeparentscrolling &amp;&amp; chkscroll &amp;&amp; !self.ispage &amp;&amp; !self.zoomactive) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
          <span class="hljs-keyword">var</span> ny = self.view.h &gt;&gt; <span class="hljs-number">1</span>;
          <span class="hljs-keyword">if</span> (self.newscrolly &lt; -ny) { self.newscrolly = -ny; py = <span class="hljs-number">-1</span>; }
          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (self.newscrolly &gt; self.page.maxh + ny) { self.newscrolly = self.page.maxh + ny; py = <span class="hljs-number">1</span>; }
          <span class="hljs-keyword">else</span> py = <span class="hljs-number">0</span>;
        }

        <span class="hljs-keyword">var</span> dy = py &gt; <span class="hljs-number">0</span> ? <span class="hljs-number">1</span> : <span class="hljs-number">-1</span>;

        <span class="hljs-keyword">if</span> (scrolldiry !== dy) {
          <span class="hljs-keyword">if</span> (self.scrollmom) self.scrollmom.stop();
          self.newscrolly = self.getScrollTop();
          scrolldiry = dy;
        }

        self.lastdeltay -= py;

      }

      <span class="hljs-keyword">if</span> (py || px) {
        self.synched(<span class="hljs-string">"relativexy"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

          <span class="hljs-keyword">var</span> dty = self.lastdeltay + self.newscrolly;
          self.lastdeltay = <span class="hljs-number">0</span>;

          <span class="hljs-keyword">var</span> dtx = self.lastdeltax + self.newscrollx;
          self.lastdeltax = <span class="hljs-number">0</span>;

          <span class="hljs-keyword">if</span> (!self.rail.drag) self.doScrollPos(dtx, dty);

        });
      }

    }

    <span class="hljs-keyword">var</span> hasparentscrollingphase = <span class="hljs-literal">false</span>;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">execScrollWheel</span>(<span class="hljs-params">e, hr, chkscroll</span>) </span>{
      <span class="hljs-keyword">var</span> px, py;

      <span class="hljs-keyword">if</span> (!chkscroll &amp;&amp; hasparentscrollingphase) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;

      <span class="hljs-keyword">if</span> (e.deltaMode === <span class="hljs-number">0</span>) { <span class="hljs-comment">// PIXEL</span>
        px = -(e.deltaX * (opt.mousescrollstep / (<span class="hljs-number">18</span> * <span class="hljs-number">3</span>))) | <span class="hljs-number">0</span>;
        py = -(e.deltaY * (opt.mousescrollstep / (<span class="hljs-number">18</span> * <span class="hljs-number">3</span>))) | <span class="hljs-number">0</span>;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e.deltaMode === <span class="hljs-number">1</span>) { <span class="hljs-comment">// LINE</span>
        px = -(e.deltaX * opt.mousescrollstep * <span class="hljs-number">50</span> / <span class="hljs-number">80</span>) | <span class="hljs-number">0</span>;
        py = -(e.deltaY * opt.mousescrollstep * <span class="hljs-number">50</span> / <span class="hljs-number">80</span>) | <span class="hljs-number">0</span>;
      }

      <span class="hljs-keyword">if</span> (hr &amp;&amp; opt.oneaxismousemode &amp;&amp; (px === <span class="hljs-number">0</span>) &amp;&amp; py) { <span class="hljs-comment">// classic vertical-only mousewheel + browser with x/y support </span>
        px = py;
        py = <span class="hljs-number">0</span>;

        <span class="hljs-keyword">if</span> (chkscroll) {
          <span class="hljs-keyword">var</span> hrend = (px &lt; <span class="hljs-number">0</span>) ? (self.getScrollLeft() &gt;= self.page.maxw) : (self.getScrollLeft() &lt;= <span class="hljs-number">0</span>);
          <span class="hljs-keyword">if</span> (hrend) {  <span class="hljs-comment">// preserve vertical scrolling</span>
            py = px;
            px = <span class="hljs-number">0</span>;
          }
        }

      }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36"></a>
</div>
<p>invert horizontal direction for rtl mode</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">if</span> (self.isrtlmode) px = -px;

      <span class="hljs-keyword">var</span> chk = doScrollRelative(px, py, chkscroll, <span class="hljs-literal">true</span>);

      <span class="hljs-keyword">if</span> (chk) {
        <span class="hljs-keyword">if</span> (chkscroll) hasparentscrollingphase = <span class="hljs-literal">true</span>;
      } <span class="hljs-keyword">else</span> {
        hasparentscrollingphase = <span class="hljs-literal">false</span>;
        e.stopImmediatePropagation();
        <span class="hljs-keyword">return</span> e.preventDefault();
      }

    }

    <span class="hljs-keyword">this</span>.onmousewheel = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
      <span class="hljs-keyword">if</span> (self.wheelprevented||self.locked) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">if</span> (self.railslocked) {
        self.debounced(<span class="hljs-string">"checkunlock"</span>, self.resize, <span class="hljs-number">250</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      }
      <span class="hljs-keyword">if</span> (self.rail.drag) <span class="hljs-keyword">return</span> self.cancelEvent(e);

      <span class="hljs-keyword">if</span> (opt.oneaxismousemode === <span class="hljs-string">"auto"</span> &amp;&amp; e.deltaX !== <span class="hljs-number">0</span>) opt.oneaxismousemode = <span class="hljs-literal">false</span>; <span class="hljs-comment">// check two-axis mouse support (not very elegant)</span>

      <span class="hljs-keyword">if</span> (opt.oneaxismousemode &amp;&amp; e.deltaX === <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">if</span> (!self.rail.scrollable) {
          <span class="hljs-keyword">if</span> (self.railh &amp;&amp; self.railh.scrollable) {
            <span class="hljs-keyword">return</span> self.onmousewheelhr(e);
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
          }
        }
      }

      <span class="hljs-keyword">var</span> nw = now();
      <span class="hljs-keyword">var</span> chk = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">if</span> (opt.preservenativescrolling &amp;&amp; ((self.checkarea + <span class="hljs-number">600</span>) &lt; nw)) {
        self.nativescrollingarea = self.isScrollable(e);
        chk = <span class="hljs-literal">true</span>;
      }
      self.checkarea = nw;
      <span class="hljs-keyword">if</span> (self.nativescrollingarea) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// this isn't my business</span>
      <span class="hljs-keyword">var</span> ret = execScrollWheel(e, <span class="hljs-literal">false</span>, chk);
      <span class="hljs-keyword">if</span> (ret) self.checkarea = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">return</span> ret;
    };

    <span class="hljs-keyword">this</span>.onmousewheelhr = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
      <span class="hljs-keyword">if</span> (self.wheelprevented) <span class="hljs-keyword">return</span>;
      <span class="hljs-keyword">if</span> (self.railslocked || !self.railh.scrollable) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">if</span> (self.rail.drag) <span class="hljs-keyword">return</span> self.cancelEvent(e);

      <span class="hljs-keyword">var</span> nw = now();
      <span class="hljs-keyword">var</span> chk = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">if</span> (opt.preservenativescrolling &amp;&amp; ((self.checkarea + <span class="hljs-number">600</span>) &lt; nw)) {
        self.nativescrollingarea = self.isScrollable(e);
        chk = <span class="hljs-literal">true</span>;
      }
      self.checkarea = nw;
      <span class="hljs-keyword">if</span> (self.nativescrollingarea) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// this is not my business</span>
      <span class="hljs-keyword">if</span> (self.railslocked) <span class="hljs-keyword">return</span> self.cancelEvent(e);

      <span class="hljs-keyword">return</span> execScrollWheel(e, <span class="hljs-literal">true</span>, chk);
    };

    <span class="hljs-keyword">this</span>.stop = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      self.cancelScroll();
      <span class="hljs-keyword">if</span> (self.scrollmon) self.scrollmon.stop();
      self.cursorfreezed = <span class="hljs-literal">false</span>;
      self.scroll.y = <span class="hljs-built_in">Math</span>.round(self.getScrollTop() * (<span class="hljs-number">1</span> / self.scrollratio.y));
      self.noticeCursor();
      <span class="hljs-keyword">return</span> self;
    };

    <span class="hljs-keyword">this</span>.getTransitionSpeed = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">dif</span>) </span>{

      <span class="hljs-keyword">return</span> <span class="hljs-number">80</span> + (dif / <span class="hljs-number">72</span>) * opt.scrollspeed |<span class="hljs-number">0</span>;

    };

    <span class="hljs-keyword">if</span> (!opt.smoothscroll) {
      <span class="hljs-keyword">this</span>.doScrollLeft = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, spd</span>) </span>{ <span class="hljs-comment">//direct</span>
        <span class="hljs-keyword">var</span> y = self.getScrollTop();
        self.doScrollPos(x, y, spd);
      };
      <span class="hljs-keyword">this</span>.doScrollTop = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">y, spd</span>) </span>{ <span class="hljs-comment">//direct</span>
        <span class="hljs-keyword">var</span> x = self.getScrollLeft();
        self.doScrollPos(x, y, spd);
      };
      <span class="hljs-keyword">this</span>.doScrollPos = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, y, spd</span>) </span>{ <span class="hljs-comment">//direct</span>
        <span class="hljs-keyword">var</span> nx = (x &gt; self.page.maxw) ? self.page.maxw : x;
        <span class="hljs-keyword">if</span> (nx &lt; <span class="hljs-number">0</span>) nx = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">var</span> ny = (y &gt; self.page.maxh) ? self.page.maxh : y;
        <span class="hljs-keyword">if</span> (ny &lt; <span class="hljs-number">0</span>) ny = <span class="hljs-number">0</span>;
        self.synched(<span class="hljs-string">'scroll'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
          self.setScrollTop(ny);
          self.setScrollLeft(nx);
        });
      };
      <span class="hljs-keyword">this</span>.cancelScroll = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ }; <span class="hljs-comment">// direct</span>

    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (self.ishwscroll &amp;&amp; cap.hastransition &amp;&amp; opt.usetransition &amp;&amp; !!opt.smoothscroll) {

      <span class="hljs-keyword">var</span> lasttransitionstyle = <span class="hljs-string">''</span>;

      <span class="hljs-keyword">this</span>.resetTransition = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        lasttransitionstyle = <span class="hljs-string">''</span>;
        self.doc.css(cap.prefixstyle + <span class="hljs-string">'transition-duration'</span>, <span class="hljs-string">'0ms'</span>);
      };

      <span class="hljs-keyword">this</span>.prepareTransition = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">dif, istime</span>) </span>{
        <span class="hljs-keyword">var</span> ex = (istime) ? dif : self.getTransitionSpeed(dif);
        <span class="hljs-keyword">var</span> trans = ex + <span class="hljs-string">'ms'</span>;
        <span class="hljs-keyword">if</span> (lasttransitionstyle !== trans) {
          lasttransitionstyle = trans;
          self.doc.css(cap.prefixstyle + <span class="hljs-string">'transition-duration'</span>, trans);
        }
        <span class="hljs-keyword">return</span> ex;
      };

      <span class="hljs-keyword">this</span>.doScrollLeft = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, spd</span>) </span>{ <span class="hljs-comment">//trans</span>
        <span class="hljs-keyword">var</span> y = (self.scrollrunning) ? self.newscrolly : self.getScrollTop();
        self.doScrollPos(x, y, spd);
      };

      <span class="hljs-keyword">this</span>.doScrollTop = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">y, spd</span>) </span>{ <span class="hljs-comment">//trans</span>
        <span class="hljs-keyword">var</span> x = (self.scrollrunning) ? self.newscrollx : self.getScrollLeft();
        self.doScrollPos(x, y, spd);
      };

      <span class="hljs-keyword">this</span>.cursorupdate = {
        <span class="hljs-attr">running</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">start</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
          <span class="hljs-keyword">var</span> m = <span class="hljs-keyword">this</span>;

          <span class="hljs-keyword">if</span> (m.running) <span class="hljs-keyword">return</span>;
          m.running = <span class="hljs-literal">true</span>;

          <span class="hljs-keyword">var</span> loop = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> (m.running) setAnimationFrame(loop);
            self.showCursor(self.getScrollTop(), self.getScrollLeft());
            self.notifyScrollEvent(self.win[<span class="hljs-number">0</span>]);
          };

          setAnimationFrame(loop);
        },
        <span class="hljs-attr">stop</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
          <span class="hljs-keyword">this</span>.running = <span class="hljs-literal">false</span>;
        }
      };

      <span class="hljs-keyword">this</span>.doScrollPos = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, y, spd</span>) </span>{ <span class="hljs-comment">//trans</span>

        <span class="hljs-keyword">var</span> py = self.getScrollTop();
        <span class="hljs-keyword">var</span> px = self.getScrollLeft();

        <span class="hljs-keyword">if</span> (((self.newscrolly - py) * (y - py) &lt; <span class="hljs-number">0</span>) || ((self.newscrollx - px) * (x - px) &lt; <span class="hljs-number">0</span>)) self.cancelScroll(); <span class="hljs-comment">//inverted movement detection      </span>

        <span class="hljs-keyword">if</span> (!opt.bouncescroll) {
          <span class="hljs-keyword">if</span> (y &lt; <span class="hljs-number">0</span>) y = <span class="hljs-number">0</span>;
          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (y &gt; self.page.maxh) y = self.page.maxh;
          <span class="hljs-keyword">if</span> (x &lt; <span class="hljs-number">0</span>) x = <span class="hljs-number">0</span>;
          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (x &gt; self.page.maxw) x = self.page.maxw;
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">if</span> (y &lt; <span class="hljs-number">0</span>) y = y / <span class="hljs-number">2</span> | <span class="hljs-number">0</span>;
          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (y &gt; self.page.maxh) y = self.page.maxh + (y - self.page.maxh) / <span class="hljs-number">2</span> | <span class="hljs-number">0</span>;
          <span class="hljs-keyword">if</span> (x &lt; <span class="hljs-number">0</span>) x = x / <span class="hljs-number">2</span> | <span class="hljs-number">0</span>;
          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (x &gt; self.page.maxw) x = self.page.maxw + (x - self.page.maxw) / <span class="hljs-number">2</span> | <span class="hljs-number">0</span>;
        }

        <span class="hljs-keyword">if</span> (self.scrollrunning &amp;&amp; x == self.newscrollx &amp;&amp; y == self.newscrolly) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

        self.newscrolly = y;
        self.newscrollx = x;

        <span class="hljs-keyword">var</span> top = self.getScrollTop();
        <span class="hljs-keyword">var</span> lft = self.getScrollLeft();

        <span class="hljs-keyword">var</span> dst = {};
        dst.x = x - lft;
        dst.y = y - top;

        <span class="hljs-keyword">var</span> dd = <span class="hljs-built_in">Math</span>.sqrt((dst.x * dst.x) + (dst.y * dst.y)) | <span class="hljs-number">0</span>;

        <span class="hljs-keyword">var</span> ms = self.prepareTransition(dd);

        <span class="hljs-keyword">if</span> (!self.scrollrunning) {
          self.scrollrunning = <span class="hljs-literal">true</span>;
          self.triggerScrollStart(lft, top, x, y, ms);
          self.cursorupdate.start();
        }

        self.scrollendtrapped = <span class="hljs-literal">true</span>;

        <span class="hljs-keyword">if</span> (!cap.transitionend) {
          <span class="hljs-keyword">if</span> (self.scrollendtrapped) clearTimeout(self.scrollendtrapped);
          self.scrollendtrapped = setTimeout(self.onScrollTransitionEnd, ms); <span class="hljs-comment">// simulate transitionend event</span>
        }

        self.setScrollTop(self.newscrolly);
        self.setScrollLeft(self.newscrollx);

      };

      <span class="hljs-keyword">this</span>.cancelScroll = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (!self.scrollendtrapped) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">var</span> py = self.getScrollTop();
        <span class="hljs-keyword">var</span> px = self.getScrollLeft();
        self.scrollrunning = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">if</span> (!cap.transitionend) clearTimeout(cap.transitionend);
        self.scrollendtrapped = <span class="hljs-literal">false</span>;
        self.resetTransition();
        self.setScrollTop(py); <span class="hljs-comment">// fire event onscroll</span>
        <span class="hljs-keyword">if</span> (self.railh) self.setScrollLeft(px);
        <span class="hljs-keyword">if</span> (self.timerscroll &amp;&amp; self.timerscroll.tm) clearInterval(self.timerscroll.tm);
        self.timerscroll = <span class="hljs-literal">false</span>;

        self.cursorfreezed = <span class="hljs-literal">false</span>;

        self.cursorupdate.stop();
        self.showCursor(py, px);
        <span class="hljs-keyword">return</span> self;
      };

      <span class="hljs-keyword">this</span>.onScrollTransitionEnd = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">if</span> (!self.scrollendtrapped) <span class="hljs-keyword">return</span>;

        <span class="hljs-keyword">var</span> py = self.getScrollTop();
        <span class="hljs-keyword">var</span> px = self.getScrollLeft();

        <span class="hljs-keyword">if</span> (py &lt; <span class="hljs-number">0</span>) py = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (py &gt; self.page.maxh) py = self.page.maxh;
        <span class="hljs-keyword">if</span> (px &lt; <span class="hljs-number">0</span>) px = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (px &gt; self.page.maxw) px = self.page.maxw;
        <span class="hljs-keyword">if</span> ((py != self.newscrolly) || (px != self.newscrollx)) <span class="hljs-keyword">return</span> self.doScrollPos(px, py, opt.snapbackspeed);

        <span class="hljs-keyword">if</span> (self.scrollrunning) self.triggerScrollEnd();
        self.scrollrunning = <span class="hljs-literal">false</span>;

        self.scrollendtrapped = <span class="hljs-literal">false</span>;
        self.resetTransition();
        self.timerscroll = <span class="hljs-literal">false</span>;
        self.setScrollTop(py); <span class="hljs-comment">// fire event onscroll        </span>
        <span class="hljs-keyword">if</span> (self.railh) self.setScrollLeft(px); <span class="hljs-comment">// fire event onscroll left</span>

        self.cursorupdate.stop();
        self.noticeCursor(<span class="hljs-literal">false</span>, py, px);

        self.cursorfreezed = <span class="hljs-literal">false</span>;

      };

    } <span class="hljs-keyword">else</span> {

      <span class="hljs-keyword">this</span>.doScrollLeft = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, spd</span>) </span>{ <span class="hljs-comment">//no-trans</span>
        <span class="hljs-keyword">var</span> y = (self.scrollrunning) ? self.newscrolly : self.getScrollTop();
        self.doScrollPos(x, y, spd);
      };

      <span class="hljs-keyword">this</span>.doScrollTop = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">y, spd</span>) </span>{ <span class="hljs-comment">//no-trans</span>
        <span class="hljs-keyword">var</span> x = (self.scrollrunning) ? self.newscrollx : self.getScrollLeft();
        self.doScrollPos(x, y, spd);
      };

      <span class="hljs-keyword">this</span>.doScrollPos = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, y, spd</span>) </span>{ <span class="hljs-comment">//no-trans</span>

        <span class="hljs-keyword">var</span> py = self.getScrollTop();
        <span class="hljs-keyword">var</span> px = self.getScrollLeft();

        <span class="hljs-keyword">if</span> (((self.newscrolly - py) * (y - py) &lt; <span class="hljs-number">0</span>) || ((self.newscrollx - px) * (x - px) &lt; <span class="hljs-number">0</span>)) self.cancelScroll(); <span class="hljs-comment">//inverted movement detection</span>

        <span class="hljs-keyword">var</span> clipped = <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">if</span> (!self.bouncescroll || !self.rail.visibility) {
          <span class="hljs-keyword">if</span> (y &lt; <span class="hljs-number">0</span>) {
            y = <span class="hljs-number">0</span>;
            clipped = <span class="hljs-literal">true</span>;
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (y &gt; self.page.maxh) {
            y = self.page.maxh;
            clipped = <span class="hljs-literal">true</span>;
          }
        }
        <span class="hljs-keyword">if</span> (!self.bouncescroll || !self.railh.visibility) {
          <span class="hljs-keyword">if</span> (x &lt; <span class="hljs-number">0</span>) {
            x = <span class="hljs-number">0</span>;
            clipped = <span class="hljs-literal">true</span>;
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (x &gt; self.page.maxw) {
            x = self.page.maxw;
            clipped = <span class="hljs-literal">true</span>;
          }
        }

        <span class="hljs-keyword">if</span> (self.scrollrunning &amp;&amp; (self.newscrolly === y) &amp;&amp; (self.newscrollx === x)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;

        self.newscrolly = y;
        self.newscrollx = x;

        self.dst = {};
        self.dst.x = x - px;
        self.dst.y = y - py;
        self.dst.px = px;
        self.dst.py = py;

        <span class="hljs-keyword">var</span> dd = <span class="hljs-built_in">Math</span>.sqrt((self.dst.x * self.dst.x) + (self.dst.y * self.dst.y)) | <span class="hljs-number">0</span>;
        <span class="hljs-keyword">var</span> ms = self.getTransitionSpeed(dd);

        self.bzscroll = {};

        <span class="hljs-keyword">var</span> p3 = (clipped) ? <span class="hljs-number">1</span> : <span class="hljs-number">0.58</span>;
        self.bzscroll.x = <span class="hljs-keyword">new</span> BezierClass(px, self.newscrollx, ms, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, p3, <span class="hljs-number">1</span>);
        self.bzscroll.y = <span class="hljs-keyword">new</span> BezierClass(py, self.newscrolly, ms, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, p3, <span class="hljs-number">1</span>);

        <span class="hljs-keyword">var</span> loopid = now();

        <span class="hljs-keyword">var</span> loop = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

          <span class="hljs-keyword">if</span> (!self.scrollrunning) <span class="hljs-keyword">return</span>;
          <span class="hljs-keyword">var</span> x = self.bzscroll.y.getPos();

          self.setScrollLeft(self.bzscroll.x.getNow());
          self.setScrollTop(self.bzscroll.y.getNow());

          <span class="hljs-keyword">if</span> (x &lt;= <span class="hljs-number">1</span>) {
            self.timer = setAnimationFrame(loop);
          } <span class="hljs-keyword">else</span> {
            self.scrollrunning = <span class="hljs-literal">false</span>;
            self.timer = <span class="hljs-number">0</span>;
            self.triggerScrollEnd();
          }

        };

        <span class="hljs-keyword">if</span> (!self.scrollrunning) {
          self.triggerScrollStart(px, py, x, y, ms);
          self.scrollrunning = <span class="hljs-literal">true</span>;
          self.timer = setAnimationFrame(loop);
        }

      };

      <span class="hljs-keyword">this</span>.cancelScroll = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (self.timer) clearAnimationFrame(self.timer);
        self.timer = <span class="hljs-number">0</span>;
        self.bzscroll = <span class="hljs-literal">false</span>;
        self.scrollrunning = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">return</span> self;
      };

    }

    <span class="hljs-keyword">this</span>.doScrollBy = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">stp, relative</span>) </span>{
      doScrollRelative(<span class="hljs-number">0</span>, stp);
    };

    <span class="hljs-keyword">this</span>.doScrollLeftBy = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">stp, relative</span>) </span>{
      doScrollRelative(stp, <span class="hljs-number">0</span>);
    };

    <span class="hljs-keyword">this</span>.doScrollTo = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">pos, relative</span>) </span>{
      <span class="hljs-keyword">var</span> ny = (relative) ? <span class="hljs-built_in">Math</span>.round(pos * self.scrollratio.y) : pos;
      <span class="hljs-keyword">if</span> (ny &lt; <span class="hljs-number">0</span>) ny = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ny &gt; self.page.maxh) ny = self.page.maxh;
      self.cursorfreezed = <span class="hljs-literal">false</span>;
      self.doScrollTop(pos);
    };

    <span class="hljs-keyword">this</span>.checkContentSize = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> pg = self.getContentSize();
      <span class="hljs-keyword">if</span> ((pg.h != self.page.h) || (pg.w != self.page.w)) self.resize(<span class="hljs-literal">false</span>, pg);
    };

    self.onscroll = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
      <span class="hljs-keyword">if</span> (self.rail.drag) <span class="hljs-keyword">return</span>;
      <span class="hljs-keyword">if</span> (!self.cursorfreezed) {
        self.synched(<span class="hljs-string">'scroll'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
          self.scroll.y = <span class="hljs-built_in">Math</span>.round(self.getScrollTop() / self.scrollratio.y);
          <span class="hljs-keyword">if</span> (self.railh) self.scroll.x = <span class="hljs-built_in">Math</span>.round(self.getScrollLeft() / self.scrollratio.x);
          self.noticeCursor();
        });
      }
    };
    self.bind(self.docscroll, <span class="hljs-string">"scroll"</span>, self.onscroll);

    <span class="hljs-keyword">this</span>.doZoomIn = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
      <span class="hljs-keyword">if</span> (self.zoomactive) <span class="hljs-keyword">return</span>;
      self.zoomactive = <span class="hljs-literal">true</span>;

      self.zoomrestore = {
        <span class="hljs-attr">style</span>: {}
      };
      <span class="hljs-keyword">var</span> lst = [<span class="hljs-string">'position'</span>, <span class="hljs-string">'top'</span>, <span class="hljs-string">'left'</span>, <span class="hljs-string">'zIndex'</span>, <span class="hljs-string">'backgroundColor'</span>, <span class="hljs-string">'marginTop'</span>, <span class="hljs-string">'marginBottom'</span>, <span class="hljs-string">'marginLeft'</span>, <span class="hljs-string">'marginRight'</span>];
      <span class="hljs-keyword">var</span> win = self.win[<span class="hljs-number">0</span>].style;
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> a <span class="hljs-keyword">in</span> lst) {
        <span class="hljs-keyword">var</span> pp = lst[a];
        self.zoomrestore.style[pp] = (win[pp] !== <span class="hljs-literal">undefined</span>) ? win[pp] : <span class="hljs-string">''</span>;
      }

      self.zoomrestore.style.width = self.win.css(<span class="hljs-string">'width'</span>);
      self.zoomrestore.style.height = self.win.css(<span class="hljs-string">'height'</span>);

      self.zoomrestore.padding = {
        <span class="hljs-attr">w</span>: self.win.outerWidth() - self.win.width(),
        <span class="hljs-attr">h</span>: self.win.outerHeight() - self.win.height()
      };

      <span class="hljs-keyword">if</span> (cap.isios4) {
        self.zoomrestore.scrollTop = $<span class="hljs-built_in">window</span>.scrollTop();
        $<span class="hljs-built_in">window</span>.scrollTop(<span class="hljs-number">0</span>);
      }

      self.win.css({
        <span class="hljs-attr">position</span>: (cap.isios4) ? <span class="hljs-string">"absolute"</span> : <span class="hljs-string">"fixed"</span>,
        <span class="hljs-attr">top</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">left</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">zIndex</span>: globalmaxzindex + <span class="hljs-number">100</span>,
        <span class="hljs-attr">margin</span>: <span class="hljs-number">0</span>
      });
      <span class="hljs-keyword">var</span> bkg = self.win.css(<span class="hljs-string">"backgroundColor"</span>);
      <span class="hljs-keyword">if</span> (<span class="hljs-string">""</span> === bkg || <span class="hljs-regexp">/transparent|rgba\(0, 0, 0, 0\)|rgba\(0,0,0,0\)/</span>.test(bkg)) self.win.css(<span class="hljs-string">"backgroundColor"</span>, <span class="hljs-string">"#fff"</span>);
      self.rail.css({
        <span class="hljs-attr">zIndex</span>: globalmaxzindex + <span class="hljs-number">101</span>
      });
      self.zoom.css({
        <span class="hljs-attr">zIndex</span>: globalmaxzindex + <span class="hljs-number">102</span>
      });
      self.zoom.css(<span class="hljs-string">'backgroundPosition'</span>, <span class="hljs-string">'0 -18px'</span>);
      self.resizeZoom();

      <span class="hljs-keyword">if</span> (self.onzoomin) self.onzoomin.call(self);

      <span class="hljs-keyword">return</span> self.cancelEvent(e);
    };

    <span class="hljs-keyword">this</span>.doZoomOut = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
      <span class="hljs-keyword">if</span> (!self.zoomactive) <span class="hljs-keyword">return</span>;
      self.zoomactive = <span class="hljs-literal">false</span>;

      self.win.css(<span class="hljs-string">"margin"</span>, <span class="hljs-string">""</span>);
      self.win.css(self.zoomrestore.style);

      <span class="hljs-keyword">if</span> (cap.isios4) {
        $<span class="hljs-built_in">window</span>.scrollTop(self.zoomrestore.scrollTop);
      }

      self.rail.css({
        <span class="hljs-string">"z-index"</span>: self.zindex
      });
      self.zoom.css({
        <span class="hljs-string">"z-index"</span>: self.zindex
      });
      self.zoomrestore = <span class="hljs-literal">false</span>;
      self.zoom.css(<span class="hljs-string">'backgroundPosition'</span>, <span class="hljs-string">'0 0'</span>);
      self.onResize();

      <span class="hljs-keyword">if</span> (self.onzoomout) self.onzoomout.call(self);

      <span class="hljs-keyword">return</span> self.cancelEvent(e);
    };

    <span class="hljs-keyword">this</span>.doZoom = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
      <span class="hljs-keyword">return</span> (self.zoomactive) ? self.doZoomOut(e) : self.doZoomIn(e);
    };

    <span class="hljs-keyword">this</span>.resizeZoom = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">if</span> (!self.zoomactive) <span class="hljs-keyword">return</span>;

      <span class="hljs-keyword">var</span> py = self.getScrollTop(); <span class="hljs-comment">//preserve scrolling position</span>
      self.win.css({
        <span class="hljs-attr">width</span>: $<span class="hljs-built_in">window</span>.width() - self.zoomrestore.padding.w + <span class="hljs-string">"px"</span>,
        <span class="hljs-attr">height</span>: $<span class="hljs-built_in">window</span>.height() - self.zoomrestore.padding.h + <span class="hljs-string">"px"</span>
      });
      self.onResize();

      self.setScrollTop(<span class="hljs-built_in">Math</span>.min(self.page.maxh, py));
    };

    <span class="hljs-keyword">this</span>.init();

    $.nicescroll.push(<span class="hljs-keyword">this</span>);

  };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37"></a>
</div>
<p>Inspired by the work of Kin Blas
http://webpro.host.adobe.com/people/jblas/momentum/includes/jquery.momentum.0.7.js</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> ScrollMomentumClass2D = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">nc</span>) </span>{
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">this</span>.nc = nc;

    <span class="hljs-keyword">this</span>.lastx = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.lasty = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.speedx = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.speedy = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.lasttime = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.steptime = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.snapx = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.snapy = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.demulx = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.demuly = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">this</span>.lastscrollx = <span class="hljs-number">-1</span>;
    <span class="hljs-keyword">this</span>.lastscrolly = <span class="hljs-number">-1</span>;

    <span class="hljs-keyword">this</span>.chkx = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.chky = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">this</span>.timer = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">this</span>.reset = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">px, py</span>) </span>{
      self.stop();
      self.steptime = <span class="hljs-number">0</span>;
      self.lasttime = now();
      self.speedx = <span class="hljs-number">0</span>;
      self.speedy = <span class="hljs-number">0</span>;
      self.lastx = px;
      self.lasty = py;
      self.lastscrollx = <span class="hljs-number">-1</span>;
      self.lastscrolly = <span class="hljs-number">-1</span>;
    };

    <span class="hljs-keyword">this</span>.update = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">px, py</span>) </span>{
      <span class="hljs-keyword">var</span> tm = now();
      self.steptime = tm - self.lasttime;
      self.lasttime = tm;
      <span class="hljs-keyword">var</span> dy = py - self.lasty;
      <span class="hljs-keyword">var</span> dx = px - self.lastx;
      <span class="hljs-keyword">var</span> sy = self.nc.getScrollTop();
      <span class="hljs-keyword">var</span> sx = self.nc.getScrollLeft();
      <span class="hljs-keyword">var</span> newy = sy + dy;
      <span class="hljs-keyword">var</span> newx = sx + dx;
      self.snapx = (newx &lt; <span class="hljs-number">0</span>) || (newx &gt; self.nc.page.maxw);
      self.snapy = (newy &lt; <span class="hljs-number">0</span>) || (newy &gt; self.nc.page.maxh);
      self.speedx = dx;
      self.speedy = dy;
      self.lastx = px;
      self.lasty = py;
    };

    <span class="hljs-keyword">this</span>.stop = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      self.nc.unsynched(<span class="hljs-string">"domomentum2d"</span>);
      <span class="hljs-keyword">if</span> (self.timer) clearTimeout(self.timer);
      self.timer = <span class="hljs-number">0</span>;
      self.lastscrollx = <span class="hljs-number">-1</span>;
      self.lastscrolly = <span class="hljs-number">-1</span>;
    };

    <span class="hljs-keyword">this</span>.doSnapy = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">nx, ny</span>) </span>{
      <span class="hljs-keyword">var</span> snap = <span class="hljs-literal">false</span>;

      <span class="hljs-keyword">if</span> (ny &lt; <span class="hljs-number">0</span>) {
        ny = <span class="hljs-number">0</span>;
        snap = <span class="hljs-literal">true</span>;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ny &gt; self.nc.page.maxh) {
        ny = self.nc.page.maxh;
        snap = <span class="hljs-literal">true</span>;
      }

      <span class="hljs-keyword">if</span> (nx &lt; <span class="hljs-number">0</span>) {
        nx = <span class="hljs-number">0</span>;
        snap = <span class="hljs-literal">true</span>;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (nx &gt; self.nc.page.maxw) {
        nx = self.nc.page.maxw;
        snap = <span class="hljs-literal">true</span>;
      }

      (snap) ? self.nc.doScrollPos(nx, ny, self.nc.opt.snapbackspeed) : self.nc.triggerScrollEnd();
    };

    <span class="hljs-keyword">this</span>.doMomentum = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">gp</span>) </span>{
      <span class="hljs-keyword">var</span> t = now();
      <span class="hljs-keyword">var</span> l = (gp) ? t + gp : self.lasttime;

      <span class="hljs-keyword">var</span> sl = self.nc.getScrollLeft();
      <span class="hljs-keyword">var</span> st = self.nc.getScrollTop();

      <span class="hljs-keyword">var</span> pageh = self.nc.page.maxh;
      <span class="hljs-keyword">var</span> pagew = self.nc.page.maxw;

      self.speedx = (pagew &gt; <span class="hljs-number">0</span>) ? <span class="hljs-built_in">Math</span>.min(<span class="hljs-number">60</span>, self.speedx) : <span class="hljs-number">0</span>;
      self.speedy = (pageh &gt; <span class="hljs-number">0</span>) ? <span class="hljs-built_in">Math</span>.min(<span class="hljs-number">60</span>, self.speedy) : <span class="hljs-number">0</span>;

      <span class="hljs-keyword">var</span> chk = l &amp;&amp; (t - l) &lt;= <span class="hljs-number">60</span>;

      <span class="hljs-keyword">if</span> ((st &lt; <span class="hljs-number">0</span>) || (st &gt; pageh) || (sl &lt; <span class="hljs-number">0</span>) || (sl &gt; pagew)) chk = <span class="hljs-literal">false</span>;

      <span class="hljs-keyword">var</span> sy = (self.speedy &amp;&amp; chk) ? self.speedy : <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">var</span> sx = (self.speedx &amp;&amp; chk) ? self.speedx : <span class="hljs-literal">false</span>;

      <span class="hljs-keyword">if</span> (sy || sx) {
        <span class="hljs-keyword">var</span> tm = <span class="hljs-built_in">Math</span>.max(<span class="hljs-number">16</span>, self.steptime); <span class="hljs-comment">//timeout granularity</span>

        <span class="hljs-keyword">if</span> (tm &gt; <span class="hljs-number">50</span>) { <span class="hljs-comment">// do smooth</span>
          <span class="hljs-keyword">var</span> xm = tm / <span class="hljs-number">50</span>;
          self.speedx *= xm;
          self.speedy *= xm;
          tm = <span class="hljs-number">50</span>;
        }

        self.demulxy = <span class="hljs-number">0</span>;

        self.lastscrollx = self.nc.getScrollLeft();
        self.chkx = self.lastscrollx;
        self.lastscrolly = self.nc.getScrollTop();
        self.chky = self.lastscrolly;

        <span class="hljs-keyword">var</span> nx = self.lastscrollx;
        <span class="hljs-keyword">var</span> ny = self.lastscrolly;

        <span class="hljs-keyword">var</span> onscroll = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
          <span class="hljs-keyword">var</span> df = ((now() - t) &gt; <span class="hljs-number">600</span>) ? <span class="hljs-number">0.04</span> : <span class="hljs-number">0.02</span>;

          <span class="hljs-keyword">if</span> (self.speedx) {
            nx = <span class="hljs-built_in">Math</span>.floor(self.lastscrollx - (self.speedx * (<span class="hljs-number">1</span> - self.demulxy)));
            self.lastscrollx = nx;
            <span class="hljs-keyword">if</span> ((nx &lt; <span class="hljs-number">0</span>) || (nx &gt; pagew)) df = <span class="hljs-number">0.10</span>;
          }

          <span class="hljs-keyword">if</span> (self.speedy) {
            ny = <span class="hljs-built_in">Math</span>.floor(self.lastscrolly - (self.speedy * (<span class="hljs-number">1</span> - self.demulxy)));
            self.lastscrolly = ny;
            <span class="hljs-keyword">if</span> ((ny &lt; <span class="hljs-number">0</span>) || (ny &gt; pageh)) df = <span class="hljs-number">0.10</span>;
          }

          self.demulxy = <span class="hljs-built_in">Math</span>.min(<span class="hljs-number">1</span>, self.demulxy + df);

          self.nc.synched(<span class="hljs-string">"domomentum2d"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

            <span class="hljs-keyword">if</span> (self.speedx) {
              <span class="hljs-keyword">var</span> scx = self.nc.getScrollLeft();
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38"></a>
</div>
<pre><code>         if (scx != self.chkx) self.stop();
</code></pre>

        </td>
        <td class="code highlight">
          <pre class="javascript">              self.chkx = nx;
              self.nc.setScrollLeft(nx);
            }

            <span class="hljs-keyword">if</span> (self.speedy) {
              <span class="hljs-keyword">var</span> scy = self.nc.getScrollTop();
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39"></a>
</div>
<pre><code>         if (scy != self.chky) self.stop();
</code></pre>

        </td>
        <td class="code highlight">
          <pre class="javascript">              self.chky = ny;
              self.nc.setScrollTop(ny);
            }

            <span class="hljs-keyword">if</span> (!self.timer) {
              self.nc.hideCursor();
              self.doSnapy(nx, ny);
            }

          });

          <span class="hljs-keyword">if</span> (self.demulxy &lt; <span class="hljs-number">1</span>) {
            self.timer = setTimeout(onscroll, tm);
          } <span class="hljs-keyword">else</span> {
            self.stop();
            self.nc.hideCursor();
            self.doSnapy(nx, ny);
          }
        };

        onscroll();

      } <span class="hljs-keyword">else</span> {
        self.doSnapy(self.nc.getScrollLeft(), self.nc.getScrollTop());
      }

    };

  };


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40"></a>
</div>
<p>override jQuery scrollTop</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> _scrollTop = jQuery.fn.scrollTop; <span class="hljs-comment">// preserve original function</span>

  jQuery.cssHooks.pageYOffset = {
    <span class="hljs-attr">get</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">elem, computed, extra</span>) </span>{
      <span class="hljs-keyword">var</span> nice = $.data(elem, <span class="hljs-string">'__nicescroll'</span>) || <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">return</span> (nice &amp;&amp; nice.ishwscroll) ? nice.getScrollTop() : _scrollTop.call(elem);
    },
    <span class="hljs-attr">set</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">elem, value</span>) </span>{
      <span class="hljs-keyword">var</span> nice = $.data(elem, <span class="hljs-string">'__nicescroll'</span>) || <span class="hljs-literal">false</span>;
      (nice &amp;&amp; nice.ishwscroll) ? nice.setScrollTop(<span class="hljs-built_in">parseInt</span>(value)) : _scrollTop.call(elem, value);
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    }
  };

  jQuery.fn.scrollTop = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) </span>{
    <span class="hljs-keyword">if</span> (value === <span class="hljs-literal">undefined</span>) {
      <span class="hljs-keyword">var</span> nice = (<span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>]) ? $.data(<span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>], <span class="hljs-string">'__nicescroll'</span>) || <span class="hljs-literal">false</span> : <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">return</span> (nice &amp;&amp; nice.ishwscroll) ? nice.getScrollTop() : _scrollTop.call(<span class="hljs-keyword">this</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.each(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> nice = $.data(<span class="hljs-keyword">this</span>, <span class="hljs-string">'__nicescroll'</span>) || <span class="hljs-literal">false</span>;
        (nice &amp;&amp; nice.ishwscroll) ? nice.setScrollTop(<span class="hljs-built_in">parseInt</span>(value)) : _scrollTop.call($(<span class="hljs-keyword">this</span>), value);
      });
    }
  };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41"></a>
</div>
<p>override jQuery scrollLeft</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> _scrollLeft = jQuery.fn.scrollLeft; <span class="hljs-comment">// preserve original function</span>

  $.cssHooks.pageXOffset = {
    <span class="hljs-attr">get</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">elem, computed, extra</span>) </span>{
      <span class="hljs-keyword">var</span> nice = $.data(elem, <span class="hljs-string">'__nicescroll'</span>) || <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">return</span> (nice &amp;&amp; nice.ishwscroll) ? nice.getScrollLeft() : _scrollLeft.call(elem);
    },
    <span class="hljs-attr">set</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">elem, value</span>) </span>{
      <span class="hljs-keyword">var</span> nice = $.data(elem, <span class="hljs-string">'__nicescroll'</span>) || <span class="hljs-literal">false</span>;
      (nice &amp;&amp; nice.ishwscroll) ? nice.setScrollLeft(<span class="hljs-built_in">parseInt</span>(value)) : _scrollLeft.call(elem, value);
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    }
  };

  jQuery.fn.scrollLeft = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) </span>{
    <span class="hljs-keyword">if</span> (value === <span class="hljs-literal">undefined</span>) {
      <span class="hljs-keyword">var</span> nice = (<span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>]) ? $.data(<span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>], <span class="hljs-string">'__nicescroll'</span>) || <span class="hljs-literal">false</span> : <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">return</span> (nice &amp;&amp; nice.ishwscroll) ? nice.getScrollLeft() : _scrollLeft.call(<span class="hljs-keyword">this</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.each(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> nice = $.data(<span class="hljs-keyword">this</span>, <span class="hljs-string">'__nicescroll'</span>) || <span class="hljs-literal">false</span>;
        (nice &amp;&amp; nice.ishwscroll) ? nice.setScrollLeft(<span class="hljs-built_in">parseInt</span>(value)) : _scrollLeft.call($(<span class="hljs-keyword">this</span>), value);
      });
    }
  };

  <span class="hljs-keyword">var</span> NiceScrollArray = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">doms</span>) </span>{
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">this</span>.length = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.name = <span class="hljs-string">"nicescrollarray"</span>;

    <span class="hljs-keyword">this</span>.each = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fn</span>) </span>{
      $.each(self, fn);
      <span class="hljs-keyword">return</span> self;
    };

    <span class="hljs-keyword">this</span>.push = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">nice</span>) </span>{
      self[self.length] = nice;
      self.length++;
    };

    <span class="hljs-keyword">this</span>.eq = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">idx</span>) </span>{
      <span class="hljs-keyword">return</span> self[idx];
    };

    <span class="hljs-keyword">if</span> (doms) {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> a = <span class="hljs-number">0</span>; a &lt; doms.length; a++) {
        <span class="hljs-keyword">var</span> nice = $.data(doms[a], <span class="hljs-string">'__nicescroll'</span>) || <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">if</span> (nice) {
          <span class="hljs-keyword">this</span>[<span class="hljs-keyword">this</span>.length] = nice;
          <span class="hljs-keyword">this</span>.length++;
        }
      }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  };

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mplex</span>(<span class="hljs-params">el, lst, fn</span>) </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> a = <span class="hljs-number">0</span>, l = lst.length; a &lt; l; a++) fn(el, lst[a]);
  }
  mplex(
    NiceScrollArray.prototype, [<span class="hljs-string">'show'</span>, <span class="hljs-string">'hide'</span>, <span class="hljs-string">'toggle'</span>, <span class="hljs-string">'onResize'</span>, <span class="hljs-string">'resize'</span>, <span class="hljs-string">'remove'</span>, <span class="hljs-string">'stop'</span>, <span class="hljs-string">'doScrollPos'</span>],
    <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e, n</span>) </span>{
      e[n] = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> args = <span class="hljs-built_in">arguments</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.each(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
          <span class="hljs-keyword">this</span>[n].apply(<span class="hljs-keyword">this</span>, args);
        });
      };
    }
  );

  jQuery.fn.getNiceScroll = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">index</span>) </span>{
    <span class="hljs-keyword">if</span> (index === <span class="hljs-literal">undefined</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> NiceScrollArray(<span class="hljs-keyword">this</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>[index] &amp;&amp; $.data(<span class="hljs-keyword">this</span>[index], <span class="hljs-string">'__nicescroll'</span>) || <span class="hljs-literal">false</span>;
    }
  };

  <span class="hljs-keyword">var</span> pseudos = jQuery.expr.pseudos || jQuery.expr[<span class="hljs-string">':'</span>];  <span class="hljs-comment">// jQuery 3 migration</span>
  pseudos.nicescroll = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a</span>) </span>{
    <span class="hljs-keyword">return</span> $.data(a, <span class="hljs-string">'__nicescroll'</span>) !== <span class="hljs-literal">undefined</span>;
  };

  $.fn.niceScroll = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">wrapper, _opt</span>) </span>{
    <span class="hljs-keyword">if</span> (_opt === <span class="hljs-literal">undefined</span> &amp;&amp; <span class="hljs-keyword">typeof</span> wrapper == <span class="hljs-string">"object"</span> &amp;&amp; !(<span class="hljs-string">"jquery"</span> <span class="hljs-keyword">in</span> wrapper)) {
      _opt = wrapper;
      wrapper = <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">var</span> ret = <span class="hljs-keyword">new</span> NiceScrollArray();

    <span class="hljs-keyword">this</span>.each(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> $<span class="hljs-keyword">this</span> = $(<span class="hljs-keyword">this</span>);

      <span class="hljs-keyword">var</span> opt = $.extend({}, _opt); <span class="hljs-comment">// cloning</span>

      <span class="hljs-keyword">if</span> (wrapper || <span class="hljs-literal">false</span>) {
        <span class="hljs-keyword">var</span> wrp = $(wrapper);
        opt.doc = (wrp.length &gt; <span class="hljs-number">1</span>) ? $(wrapper, $<span class="hljs-keyword">this</span>) : wrp;
        opt.win = $<span class="hljs-keyword">this</span>;
      }
      <span class="hljs-keyword">var</span> docundef = !(<span class="hljs-string">"doc"</span> <span class="hljs-keyword">in</span> opt);
      <span class="hljs-keyword">if</span> (!docundef &amp;&amp; !(<span class="hljs-string">"win"</span> <span class="hljs-keyword">in</span> opt)) opt.win = $<span class="hljs-keyword">this</span>;

      <span class="hljs-keyword">var</span> nice = $<span class="hljs-keyword">this</span>.data(<span class="hljs-string">'__nicescroll'</span>) || <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">if</span> (!nice) {
        opt.doc = opt.doc || $<span class="hljs-keyword">this</span>;
        nice = <span class="hljs-keyword">new</span> NiceScrollClass(opt, $<span class="hljs-keyword">this</span>);
        $<span class="hljs-keyword">this</span>.data(<span class="hljs-string">'__nicescroll'</span>, nice);
      }
      ret.push(nice);
    });

    <span class="hljs-keyword">return</span> (ret.length === <span class="hljs-number">1</span>) ? ret[<span class="hljs-number">0</span>] : ret;
  };

  _win.NiceScroll = {
    <span class="hljs-attr">getjQuery</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> jQuery;
    }
  };

  <span class="hljs-keyword">if</span> (!$.nicescroll) {
    $.nicescroll = <span class="hljs-keyword">new</span> NiceScrollArray();
    $.nicescroll.options = _globaloptions;
  }

}));
</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
